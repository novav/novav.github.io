<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"novav.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":-1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="outlook: [TOC] 数据转换C++: byte和int的相互转化_PuttyTree的博客-CSDN博客_c++ byte转int C++ socktrecv123const int bufLen &#x3D; 256;char buffer[bufLen];int resultLen &#x3D; recv(sclient, buffer, bufLen, 0);  FIX-01 “undefined r">
<meta property="og:type" content="article">
<meta property="og:title" content="C++ 网络编程">
<meta property="og:url" content="https://novav.github.io/2022/07/12/Sub_Language/CPlus/Cplus_TCP/index.html">
<meta property="og:site_name" content="Simon Shi的小站">
<meta property="og:description" content="outlook: [TOC] 数据转换C++: byte和int的相互转化_PuttyTree的博客-CSDN博客_c++ byte转int C++ socktrecv123const int bufLen &#x3D; 256;char buffer[bufLen];int resultLen &#x3D; recv(sclient, buffer, bufLen, 0);  FIX-01 “undefined r">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-07-12T12:00:00.000Z">
<meta property="article:modified_time" content="2025-08-06T08:16:40.528Z">
<meta property="article:author" content="Simon Shi">
<meta property="article:tag" content="C++">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://novav.github.io/2022/07/12/Sub_Language/CPlus/Cplus_TCP/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>C++ 网络编程 | Simon Shi的小站</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Simon Shi的小站</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">人工智能，机器学习， 强化学习，大模型，自动驾驶</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://novav.github.io/2022/07/12/Sub_Language/CPlus/Cplus_TCP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Simon Shi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Simon Shi的小站">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          C++ 网络编程
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-07-12 12:00:00" itemprop="dateCreated datePublished" datetime="2022-07-12T12:00:00+00:00">2022-07-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-08-06 08:16:40" itemprop="dateModified" datetime="2025-08-06T08:16:40+00:00">2025-08-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/dev/" itemprop="url" rel="index"><span itemprop="name">dev</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/dev/c/" itemprop="url" rel="index"><span itemprop="name">c++</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>outlook:</p>
<p>[TOC]</p>
<h1 id="数据转换"><a href="#数据转换" class="headerlink" title="数据转换"></a>数据转换</h1><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/PuttyTree/article/details/7825709">C++: byte和int的相互转化_PuttyTree的博客-CSDN博客_c++ byte转int</a></p>
<h1 id="C-sockt"><a href="#C-sockt" class="headerlink" title="C++ sockt"></a>C++ sockt</h1><h2 id="recv"><a href="#recv" class="headerlink" title="recv"></a>recv</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> bufLen = <span class="number">256</span>;</span><br><span class="line"><span class="type">char</span> buffer[bufLen];</span><br><span class="line"><span class="type">int</span> resultLen = <span class="built_in">recv</span>(sclient, buffer, bufLen, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<h3 id="FIX-01-“undefined-reference-to-imp-WSAStartup’”"><a href="#FIX-01-“undefined-reference-to-imp-WSAStartup’”" class="headerlink" title="FIX-01 “undefined reference to __imp_WSAStartup’”"></a>FIX-01 “undefined reference to __imp_WSAStartup’”</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--# VS task.xml配置修改：--&gt;</span></span><br><span class="line">  &quot;args&quot;: [</span><br><span class="line">     &quot;C:/Program Files (x86)/Windows Kits/10/Lib/10.0.19041.0/um/x64/WS2_32.Lib&quot;,</span><br><span class="line"> ]</span><br></pre></td></tr></table></figure>

<h1 id="Windows-网络编程"><a href="#Windows-网络编程" class="headerlink" title="Windows 网络编程"></a>Windows 网络编程</h1><p>阻塞模式开发（执行I&#x2F;O操作时，线程被阻塞调用）</p>
<p>非阻塞模式开发（执行I&#x2F;O操作时，立即返回，但是要处理返回错误的问题）</p>
<p>套接字Select模型（常见的I&#x2F;O模型）</p>
<h2 id="UDP-Send-Recv-Text"><a href="#UDP-Send-Recv-Text" class="headerlink" title="UDP (Send&#x2F;Recv Text)"></a>UDP (Send&#x2F;Recv Text)</h2><h3 id="Sever"><a href="#Sever" class="headerlink" title="Sever"></a>Sever</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;winsock2.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;windows.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib, <span class="string">&quot;ws2_32.lib&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    WSADATA wsd; </span><br><span class="line">    SOCKET  s;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// init </span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">WSAStartup</span>(<span class="built_in">MAKEWORD</span>(<span class="number">2</span>,<span class="number">2</span>), &amp;wsd) != <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;WSA Start UP faild&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// socket creat</span></span><br><span class="line">    s = <span class="built_in">socket</span>(AF_INET, SOCK_DGRAM, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (s == INVALID_SOCKET)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;socket() failed &quot;</span> &lt;&lt; <span class="built_in">WSAGetLastError</span>() &lt;&lt; endl;</span><br><span class="line">        <span class="built_in">WSACleanup</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// socket bind</span></span><br><span class="line">    SOCKADDR_IN  servAddr;</span><br><span class="line">    servAddr.sin_family = AF_INET;</span><br><span class="line">    servAddr.sin_port = <span class="built_in">htons</span>((<span class="type">short</span>) <span class="number">5000</span>);        <span class="comment">// PORT</span></span><br><span class="line">    servAddr.sin_addr.s_addr = <span class="built_in">htonl</span>(INADDR_ANY);   <span class="comment">// IP</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">bind</span>(s, (SOCKADDR*)&amp;servAddr, <span class="built_in">sizeof</span>(servAddr)) == SOCKET_ERROR)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;bind() failed &quot;</span> &lt;&lt; <span class="built_in">WSAGetLastError</span>() &lt;&lt; endl;</span><br><span class="line">        <span class="built_in">closesocket</span>(s);</span><br><span class="line">        <span class="built_in">WSACleanup</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// recv</span></span><br><span class="line">    <span class="type">int</span> BUF_SIZE = <span class="number">64</span>;</span><br><span class="line">    <span class="type">char</span> buf[BUF_SIZE];</span><br><span class="line">    <span class="comment">// recv</span></span><br><span class="line">    SOCKADDR_IN clientAddr;</span><br><span class="line">    <span class="type">int</span> nClientLen = <span class="built_in">sizeof</span>(clientAddr);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">recvfrom</span>(s, buf, BUF_SIZE, <span class="number">0</span>, (SOCKADDR*)&amp;clientAddr, &amp;nClientLen) == SOCKET_ERROR)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;recefrom() failed &quot;</span> &lt;&lt; <span class="built_in">WSAGetLastError</span>() &lt;&lt; endl;</span><br><span class="line">        <span class="built_in">closesocket</span>(s);</span><br><span class="line">        <span class="built_in">WSACleanup</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; clientAddr.sin_addr.s_addr &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;recv : &quot;</span> &lt;&lt; buf &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="client"><a href="#client" class="headerlink" title="client"></a>client</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;winsock2.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;windows.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function">string <span class="title">constructBody</span><span class="params">(string args[<span class="number">2</span>], string file[<span class="number">2</span>])</span></span>;</span><br><span class="line"><span class="function">string <span class="title">readFile</span><span class="params">(string fileName)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PORT 5000</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IP <span class="string">&quot;127.0.0.1&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> HOST <span class="string">&quot;localhost&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RECEIVER <span class="string">&quot;receive_data&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> COMPNAME <span class="string">&quot;compname&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PROGRAM <span class="string">&quot;program&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILENAME <span class="string">&quot;file&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BOUNDARY <span class="string">&quot;--------FVIAlihiu&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DUMMY_DATA <span class="string">&quot;-todo&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DUMMY_FILE <span class="string">&quot;dummy.txt&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/// @brief Windows SOcket 网络开发</span></span><br><span class="line"><span class="comment">///     ref : http://9v.lt/blog/sending-multipart-post-requests-c/</span></span><br><span class="line"><span class="comment">/// @return</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    SOCKET dataSock;</span><br><span class="line">    WSADATA wasData;</span><br><span class="line">    <span class="type">int</span> error = <span class="built_in">WSAStartup</span>(<span class="number">0x0202</span>, &amp;wasData);</span><br><span class="line">    <span class="keyword">if</span> (error != <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">WSACleanup</span>();</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// dataSock = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);</span></span><br><span class="line">    dataSock = <span class="built_in">socket</span>(AF_INET, SOCK_DGRAM, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (dataSock == INVALID_SOCKET)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    SOCKADDR_IN target;</span><br><span class="line">    target.sin_family = AF_INET;</span><br><span class="line">    target.sin_port = <span class="built_in">htons</span>(PORT);</span><br><span class="line">    target.sin_addr.s_addr = <span class="built_in">inet_addr</span>(IP);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">connect</span>(dataSock, (SOCKADDR*)&amp;target, <span class="built_in">sizeof</span>(target));</span><br><span class="line"></span><br><span class="line">    string programNames[<span class="number">1</span>][<span class="number">2</span>] = &#123;&#123;<span class="string">&quot;KULVERTOP&quot;</span>, <span class="string">&quot;Chrome&quot;</span>&#125;&#125;;</span><br><span class="line">    string file[<span class="number">2</span>] = &#123;FILENAME, <span class="string">&quot;Default.txt&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> a = <span class="built_in">sizeof</span>( programNames)/<span class="built_in">sizeof</span>( programNames[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; a; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Send data for &quot;</span> &lt;&lt; programNames[i][<span class="number">1</span>] &lt;&lt; endl;</span><br><span class="line">        string body = <span class="built_in">constructBody</span>(programNames[i], file);</span><br><span class="line">        <span class="type">char</span> header[<span class="number">1024</span>];</span><br><span class="line">        <span class="comment">// cout &lt;&lt; header</span></span><br><span class="line">        <span class="built_in">sprintf</span>(header, <span class="string">&quot;POST %s HTTP1.1 \r\n&quot;</span></span><br><span class="line">                        <span class="string">&quot;Host: %s\r\n&quot;</span></span><br><span class="line">                        <span class="string">&quot;Content-Length: %d\r\n&quot;</span></span><br><span class="line">                        <span class="string">&quot;Content-Type: multipart/from-data; boundary=%s\r\n&quot;</span></span><br><span class="line">                        <span class="string">&quot;Accept-Charset: utf-8\r\n\r\n&quot;</span>,</span><br><span class="line">                RECEIVER, IP, <span class="built_in">strlen</span>(body.<span class="built_in">c_str</span>()), BOUNDARY);</span><br><span class="line"></span><br><span class="line">        cout &lt;&lt; header &lt;&lt; endl;</span><br><span class="line">        <span class="comment">// int p = send(dataSock, header, strlen(header), 0);</span></span><br><span class="line">        <span class="comment">// int k = send(dataSock, body.c_str(), strlen(body.c_str()), 0);</span></span><br><span class="line">        <span class="type">char</span> buf[<span class="number">64</span>] = <span class="string">&quot;My UDP&quot;</span>;</span><br><span class="line">        <span class="comment">// int t = send(dataSock, buf, strlen(buf), 0);</span></span><br><span class="line">        <span class="type">int</span> t = <span class="built_in">send</span>(dataSock, buf, <span class="number">64</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">closesocket</span>(dataSock);</span><br><span class="line">    <span class="built_in">WSACleanup</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">string <span class="title">readFile</span><span class="params">(string file)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    string fileContents;</span><br><span class="line">    <span class="function">ifstream <span class="title">tmp</span><span class="params">(file.c_str())</span></span>;</span><br><span class="line">    <span class="built_in">getline</span>(tmp, fileContents);</span><br><span class="line">    tmp.<span class="built_in">close</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> fileContents;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">string <span class="title">constructBody</span><span class="params">(string args[<span class="number">2</span>], string file[<span class="number">2</span>])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    string body;</span><br><span class="line">    string CRLF = <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// first we add the args</span></span><br><span class="line">    body.<span class="built_in">append</span>(<span class="string">&quot;--&quot;</span> + <span class="built_in">string</span>(BOUNDARY) + CRLF);</span><br><span class="line">    body.<span class="built_in">append</span>(<span class="string">&quot;Content-Disposition: from-data; name=\&quot;&quot;</span> + <span class="built_in">string</span>(COMPNAME) + <span class="string">&quot;\&quot;&quot;</span> + CRLF);</span><br><span class="line">    body.<span class="built_in">append</span>(CRLF);</span><br><span class="line">    body.<span class="built_in">append</span>(args[<span class="number">0</span>] + CRLF);</span><br><span class="line">    body.<span class="built_in">append</span>(<span class="string">&quot;--&quot;</span> + <span class="built_in">string</span>(BOUNDARY) + CRLF);</span><br><span class="line">    body.<span class="built_in">append</span>(<span class="string">&quot;Content-Disposition: from-data; name=\&quot;&quot;</span> + <span class="built_in">string</span>(PROGRAM) + <span class="string">&quot;\&quot;&quot;</span> + CRLF);</span><br><span class="line">    body.<span class="built_in">append</span>(CRLF);</span><br><span class="line">    body.<span class="built_in">append</span>(args[<span class="number">1</span>] + CRLF);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// now we add the file</span></span><br><span class="line">    body.<span class="built_in">append</span>(<span class="string">&quot;--&quot;</span> + <span class="built_in">string</span>(BOUNDARY) + CRLF);</span><br><span class="line">    body.<span class="built_in">append</span>(<span class="string">&quot;Content-Disposition: from-data; name=\&quot;&quot;</span> + <span class="built_in">string</span>(FILENAME) + <span class="string">&quot;\&quot;; filename=\&quot;&quot;</span> + <span class="built_in">string</span>(DUMMY_FILE) + <span class="string">&quot;\&quot;&quot;</span> + CRLF);</span><br><span class="line">    body.<span class="built_in">append</span>(<span class="string">&quot;Content-Type:text/plain&quot;</span> + CRLF);</span><br><span class="line">    body.<span class="built_in">append</span>(<span class="string">&quot;--&quot;</span> + <span class="built_in">string</span>(BOUNDARY) + <span class="string">&quot;--&quot;</span> + CRLF);</span><br><span class="line">    body.<span class="built_in">append</span>(CRLF);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> body;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="demo-Socket文件传输"><a href="#demo-Socket文件传输" class="headerlink" title="demo::Socket文件传输"></a>demo::Socket文件传输</h1><table>
<thead>
<tr>
<th></th>
<th>Client</th>
<th>Server</th>
</tr>
</thead>
<tbody><tr>
<td>Method-1</td>
<td>发送4字节（的文件长度）+文件的内容String</td>
<td>接受对应格式的文件</td>
</tr>
<tr>
<td>Method-2</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h1 id="LINUX网络编程"><a href="#LINUX网络编程" class="headerlink" title="LINUX网络编程"></a>LINUX网络编程</h1><h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_48243698/article/details/123510416">c++网络编程基础知识总结_你最特别17的博客-CSDN博客_网络口c++</a></p>
<p><a target="_blank" rel="noopener" href="http://www.cppblog.com/markqian86/archive/2020/04/24/217259.html">EPOLLIN , EPOLLOUT , EPOLLPRI, EPOLLERR 和 EPOLLHUP事件</a></p>
<p>poll()函数<a target="_blank" rel="noopener" href="http://www.cppblog.com/myjfm/archive/2011/10/26/159093.aspx">ref</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">POLLIN:                有普通数据或者优先数据可读</span><br><span class="line">POLLRDNORM:    有普通数据可读</span><br><span class="line">POLLRDBAND:    有优先数据可读</span><br><span class="line">POLLPRI:              有紧急数据可读</span><br><span class="line">POLLOUT:            有普通数据可写</span><br><span class="line">POLLWRNORM:   有普通数据可写</span><br><span class="line">POLLWRBAND:    有紧急数据可写</span><br><span class="line">POLLERR:            有错误发生</span><br><span class="line">POLLHUP:            有描述符挂起事件发生</span><br><span class="line">POLLNVAL:          描述符非法</span><br></pre></td></tr></table></figure>

<h2 id="Client"><a href="#Client" class="headerlink" title="Client"></a>Client</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//client Linux </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cerrno&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;this is client&quot;</span> &lt;&lt;endl;</span><br><span class="line">    <span class="type">int</span> client = <span class="built_in">socket</span>(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span>(client == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot; socket err &quot;</span> &lt;&lt;endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> serverAddr;</span><br><span class="line">    serverAddr.sin_family = AF_INET;</span><br><span class="line">    serverAddr.sin_port = <span class="built_in">htons</span>(<span class="number">7637</span>);</span><br><span class="line">    serverAddr.sin_addr.s_addr = <span class="built_in">inet_addr</span>(<span class="string">&quot;127.0.0.1&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">connect</span>(client, (<span class="keyword">struct</span> sockaddr_in*) &amp;serverAddr, <span class="built_in">sizeof</span>(serverAddr)) &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;connect err&quot;</span> &lt;&lt;endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;connect ....&quot;</span> &lt;&lt;endl;</span><br><span class="line">    <span class="type">char</span> data[<span class="number">255</span>];</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">255</span>];</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cin &gt;&gt; data;</span><br><span class="line">        <span class="built_in">send</span>(client, data, <span class="built_in">strlen</span>(data), <span class="number">0</span>);   </span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">strcmp</span>(data, <span class="string">&quot;exit&quot;</span>) == <span class="number">0</span> || <span class="built_in">strcmp</span>(data, <span class="string">&quot;EXIT&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;client disconnect ...&quot;</span> &lt;&lt;endl;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="built_in">memset</span>(buf, <span class="number">0</span> ,<span class="built_in">sizeof</span>(buf));</span><br><span class="line">        <span class="type">int</span> len = <span class="built_in">recv</span>(client, buf, <span class="built_in">sizeof</span>(buf), <span class="number">0</span>);</span><br><span class="line">        buf[len] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        cout &lt;&lt; buf &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">close</span>(client);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//server linux </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cerrno&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;this is server&quot;</span> &lt;&lt;endl;</span><br><span class="line">    <span class="type">int</span> listenfd = <span class="built_in">socket</span>(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (listenfd == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;socker err &quot;</span> &lt;&lt;endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> addr;</span><br><span class="line">    addr.sin_family = AF_INET;</span><br><span class="line">    addr.sin_port = <span class="built_in">htons</span>(<span class="number">7637</span>);</span><br><span class="line">    addr.sin_addr.s_addr = INADDR_ANY;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">bind</span>(listenfd, (<span class="keyword">struct</span> sockaddr*) &amp;addr,<span class="built_in">sizeof</span>(addr)) == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;bind err&quot;</span> &lt;&lt;endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">listen</span>(listenfd , <span class="number">5</span>) == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt;<span class="string">&quot;listen err&quot;</span> &lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> conn;</span><br><span class="line">    <span class="type">char</span> clientIP[INET_ADDRSTRLEN] = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> clientAddr;</span><br><span class="line">    <span class="type">socklen_t</span> clinetAddrLen = <span class="built_in">sizeof</span>(clientAddr);</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;listen ....&quot;</span> &lt;&lt;endl;</span><br><span class="line">        conn = <span class="built_in">accept</span>(listenfd, (<span class="keyword">struct</span> sockaddr*)&amp;clientAddr, &amp;clinetAddrLen);</span><br><span class="line">        <span class="keyword">if</span>(conn &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt;<span class="string">&quot;conn accept err &quot;</span> &lt;&lt;endl;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">inet_ntop</span>(AF_INET, &amp;clientAddr.sin_addr, clientIP, INET_ADDRSTRLEN);</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot; connect &quot;</span> &lt;&lt; clientIP &lt;&lt; <span class="string">&quot;:&quot;</span> &lt;&lt; <span class="built_in">ntohs</span>(clientAddr.sin_port) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">        <span class="type">char</span> buf[<span class="number">255</span>];</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">memset</span>(buf, <span class="number">0</span> , <span class="built_in">sizeof</span>(buf));</span><br><span class="line">            <span class="type">int</span> len = <span class="built_in">recv</span>(conn, buf, <span class="built_in">sizeof</span>(buf), <span class="number">0</span>);</span><br><span class="line">            buf[len] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">strcmp</span>(buf,<span class="string">&quot;exit&quot;</span>) == <span class="number">0</span> || <span class="built_in">strcmp</span>(buf,<span class="string">&quot;EXIT&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                cout &lt;&lt; <span class="string">&quot;disconnect &quot;</span> &lt;&lt; clientIP &lt;&lt; <span class="string">&quot;:&quot;</span> &lt;&lt;<span class="built_in">ntohs</span>(clientAddr.sin_port) &lt;&lt; endl;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            cout &lt;&lt; buf &lt;&lt; endl;</span><br><span class="line">            <span class="built_in">send</span>(conn, buf, len,<span class="number">0</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">close</span>(conn);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">close</span>(listenfd);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Kiris_king/article/details/128096893">C++ socket demo_andyleung520的博客-CSDN博客_c++ socket demo</a></p>
<h1 id="C-Http"><a href="#C-Http" class="headerlink" title="C++ Http"></a>C++ Http</h1><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Blejixiang/article/details/127830555">C++ 发送HTTP请求_BUG·搬运工的博客-CSDN博客_c++ http请求</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;HTTPRequest.hpp&quot;</span> <span class="comment">//相关源码在文章末尾</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">//注意：URI地址必须以 http:// 开头，否则不符合头文件校验规则</span></span><br><span class="line">string uri = <span class="string">&quot;http://en.xxx.com/api-ctl/client/health/&quot;</span>;</span><br><span class="line">string method = <span class="string">&quot;POST&quot;</span>;</span><br><span class="line">string arguments = <span class="built_in">string_To_UTF8</span>((<span class="type">char</span>*)encryptStr.<span class="built_in">c_str</span>());</span><br><span class="line"><span class="keyword">auto</span> protocol = http::InternetProtocol::V4;</span><br><span class="line">http::Request req&#123; uri, protocol &#125;;</span><br><span class="line"></span><br><span class="line">json responseJson;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="keyword">auto</span> response = req.<span class="built_in">send</span>(method, arguments, &#123;</span><br><span class="line">    &#123;<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;User-Agent&quot;</span>, <span class="string">&quot;runscope/0.1&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;Accept&quot;</span>, <span class="string">&quot;*/*&quot;</span>&#125;</span><br><span class="line">        &#125;, std::chrono::<span class="built_in">seconds</span>(<span class="number">2</span>));</span><br><span class="line">    responseJson = json::<span class="built_in">parse</span>(string&#123; response.body.<span class="built_in">begin</span>(), response.body.<span class="built_in">end</span>() &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">catch</span> (exception&amp; e) &#123;</span><br><span class="line">    <span class="comment">//捕获请求失败异常，处理逻辑自行添加</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="HTTPRequest-hpp"><a href="#HTTPRequest-hpp" class="headerlink" title="HTTPRequest.hpp"></a>HTTPRequest.hpp</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  HTTPRequest</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> HTTPREQUEST_HPP</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> HTTPREQUEST_HPP</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstddef&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdint&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;array&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdexcept&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;system_error&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;type_traits&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(_WIN32) || defined(__CYGWIN__)</span></span><br><span class="line"><span class="meta">#  <span class="keyword">pragma</span> push_macro(<span class="string">&quot;WIN32_LEAN_AND_MEAN&quot;</span>)</span></span><br><span class="line"><span class="meta">#  <span class="keyword">pragma</span> push_macro(<span class="string">&quot;NOMINMAX&quot;</span>)</span></span><br><span class="line"><span class="meta">#  <span class="keyword">ifndef</span> WIN32_LEAN_AND_MEAN</span></span><br><span class="line"><span class="meta">#    <span class="keyword">define</span> WIN32_LEAN_AND_MEAN</span></span><br><span class="line"><span class="meta">#  <span class="keyword">endif</span> <span class="comment">// WIN32_LEAN_AND_MEAN</span></span></span><br><span class="line"><span class="meta">#  <span class="keyword">ifndef</span> NOMINMAX</span></span><br><span class="line"><span class="meta">#    <span class="keyword">define</span> NOMINMAX</span></span><br><span class="line"><span class="meta">#  <span class="keyword">endif</span> <span class="comment">// NOMINMAX</span></span></span><br><span class="line"><span class="meta">#  <span class="keyword">include</span> <span class="string">&lt;winsock2.h&gt;</span></span></span><br><span class="line"><span class="meta">#  <span class="keyword">if</span> _WIN32_WINNT &lt; _WIN32_WINNT_WINXP</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="type">char</span> *_strdup(<span class="type">const</span> <span class="type">char</span> *strSource);</span><br><span class="line"><span class="meta">#    <span class="keyword">define</span> strdup _strdup</span></span><br><span class="line"><span class="meta">#    <span class="keyword">include</span> <span class="string">&lt;wspiapi.h&gt;</span></span></span><br><span class="line"><span class="meta">#  <span class="keyword">endif</span> <span class="comment">// _WIN32_WINNT &lt; _WIN32_WINNT_WINXP</span></span></span><br><span class="line"><span class="meta">#  <span class="keyword">include</span> <span class="string">&lt;ws2tcpip.h&gt;</span></span></span><br><span class="line"><span class="meta">#  <span class="keyword">pragma</span> pop_macro(<span class="string">&quot;WIN32_LEAN_AND_MEAN&quot;</span>)</span></span><br><span class="line"><span class="meta">#  <span class="keyword">pragma</span> pop_macro(<span class="string">&quot;NOMINMAX&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#  <span class="keyword">include</span> <span class="string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#  <span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#  <span class="keyword">include</span> <span class="string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"><span class="meta">#  <span class="keyword">include</span> <span class="string">&lt;netdb.h&gt;</span></span></span><br><span class="line"><span class="meta">#  <span class="keyword">include</span> <span class="string">&lt;sys/select.h&gt;</span></span></span><br><span class="line"><span class="meta">#  <span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#  <span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#  <span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// defined(_WIN32) || defined(__CYGWIN__)</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> http</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">RequestError</span> <span class="keyword">final</span>: <span class="keyword">public</span> std::logic_error</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="keyword">using</span> std::logic_error::logic_error;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">ResponseError</span> <span class="keyword">final</span>: <span class="keyword">public</span> std::runtime_error</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="keyword">using</span> std::runtime_error::runtime_error;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">enum class</span> <span class="title class_">InternetProtocol</span>: std::<span class="type">uint8_t</span></span><br><span class="line">    &#123;</span><br><span class="line">        V4,</span><br><span class="line">        V6</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Uri</span> <span class="keyword">final</span></span><br><span class="line">    &#123;</span><br><span class="line">        std::string scheme;</span><br><span class="line">        std::string user;</span><br><span class="line">        std::string password;</span><br><span class="line">        std::string host;</span><br><span class="line">        std::string port;</span><br><span class="line">        std::string path;</span><br><span class="line">        std::string query;</span><br><span class="line">        std::string fragment;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">HttpVersion</span> <span class="keyword">final</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">uint16_t</span> major;</span><br><span class="line">        <span class="type">uint16_t</span> minor;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Status</span> <span class="keyword">final</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// RFC 7231, 6. Response Status Codes</span></span><br><span class="line">        <span class="keyword">enum</span> <span class="title class_">Code</span>: std::<span class="type">uint16_t</span></span><br><span class="line">        &#123;</span><br><span class="line">            Continue = <span class="number">100</span>,</span><br><span class="line">            SwitchingProtocol = <span class="number">101</span>,</span><br><span class="line">            Processing = <span class="number">102</span>,</span><br><span class="line">            EarlyHints = <span class="number">103</span>,</span><br><span class="line"></span><br><span class="line">            Ok = <span class="number">200</span>,</span><br><span class="line">            Created = <span class="number">201</span>,</span><br><span class="line">            Accepted = <span class="number">202</span>,</span><br><span class="line">            NonAuthoritativeInformation = <span class="number">203</span>,</span><br><span class="line">            NoContent = <span class="number">204</span>,</span><br><span class="line">            ResetContent = <span class="number">205</span>,</span><br><span class="line">            PartialContent = <span class="number">206</span>,</span><br><span class="line">            MultiStatus = <span class="number">207</span>,</span><br><span class="line">            AlreadyReported = <span class="number">208</span>,</span><br><span class="line">            ImUsed = <span class="number">226</span>,</span><br><span class="line"></span><br><span class="line">            MultipleChoice = <span class="number">300</span>,</span><br><span class="line">            MovedPermanently = <span class="number">301</span>,</span><br><span class="line">            Found = <span class="number">302</span>,</span><br><span class="line">            SeeOther = <span class="number">303</span>,</span><br><span class="line">            NotModified = <span class="number">304</span>,</span><br><span class="line">            UseProxy = <span class="number">305</span>,</span><br><span class="line">            TemporaryRedirect = <span class="number">307</span>,</span><br><span class="line">            PermanentRedirect = <span class="number">308</span>,</span><br><span class="line"></span><br><span class="line">            BadRequest = <span class="number">400</span>,</span><br><span class="line">            Unauthorized = <span class="number">401</span>,</span><br><span class="line">            PaymentRequired = <span class="number">402</span>,</span><br><span class="line">            Forbidden = <span class="number">403</span>,</span><br><span class="line">            NotFound = <span class="number">404</span>,</span><br><span class="line">            MethodNotAllowed = <span class="number">405</span>,</span><br><span class="line">            NotAcceptable = <span class="number">406</span>,</span><br><span class="line">            ProxyAuthenticationRequired = <span class="number">407</span>,</span><br><span class="line">            RequestTimeout = <span class="number">408</span>,</span><br><span class="line">            Conflict = <span class="number">409</span>,</span><br><span class="line">            Gone = <span class="number">410</span>,</span><br><span class="line">            LengthRequired = <span class="number">411</span>,</span><br><span class="line">            PreconditionFailed = <span class="number">412</span>,</span><br><span class="line">            PayloadTooLarge = <span class="number">413</span>,</span><br><span class="line">            UriTooLong = <span class="number">414</span>,</span><br><span class="line">            UnsupportedMediaType = <span class="number">415</span>,</span><br><span class="line">            RangeNotSatisfiable = <span class="number">416</span>,</span><br><span class="line">            ExpectationFailed = <span class="number">417</span>,</span><br><span class="line">            MisdirectedRequest = <span class="number">421</span>,</span><br><span class="line">            UnprocessableEntity = <span class="number">422</span>,</span><br><span class="line">            Locked = <span class="number">423</span>,</span><br><span class="line">            FailedDependency = <span class="number">424</span>,</span><br><span class="line">            TooEarly = <span class="number">425</span>,</span><br><span class="line">            UpgradeRequired = <span class="number">426</span>,</span><br><span class="line">            PreconditionRequired = <span class="number">428</span>,</span><br><span class="line">            TooManyRequests = <span class="number">429</span>,</span><br><span class="line">            RequestHeaderFieldsTooLarge = <span class="number">431</span>,</span><br><span class="line">            UnavailableForLegalReasons = <span class="number">451</span>,</span><br><span class="line"></span><br><span class="line">            InternalServerError = <span class="number">500</span>,</span><br><span class="line">            NotImplemented = <span class="number">501</span>,</span><br><span class="line">            BadGateway = <span class="number">502</span>,</span><br><span class="line">            ServiceUnavailable = <span class="number">503</span>,</span><br><span class="line">            GatewayTimeout = <span class="number">504</span>,</span><br><span class="line">            HttpVersionNotSupported = <span class="number">505</span>,</span><br><span class="line">            VariantAlsoNegotiates = <span class="number">506</span>,</span><br><span class="line">            InsufficientStorage = <span class="number">507</span>,</span><br><span class="line">            LoopDetected = <span class="number">508</span>,</span><br><span class="line">            NotExtended = <span class="number">510</span>,</span><br><span class="line">            NetworkAuthenticationRequired = <span class="number">511</span></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        HttpVersion httpVersion;</span><br><span class="line">        std::<span class="type">uint16_t</span> code;</span><br><span class="line">        std::string reason;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> HeaderField = std::pair&lt;std::string, std::string&gt;;</span><br><span class="line">    <span class="keyword">using</span> HeaderFields = std::vector&lt;HeaderField&gt;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Response</span> <span class="keyword">final</span></span><br><span class="line">    &#123;</span><br><span class="line">        Status status;</span><br><span class="line">        HeaderFields headerFields;</span><br><span class="line">        std::vector&lt;std::<span class="type">uint8_t</span>&gt; body;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">inline</span> <span class="keyword">namespace</span> detail</span><br><span class="line">    &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(_WIN32) || defined(__CYGWIN__)</span></span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">WinSock</span> <span class="keyword">final</span></span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">public</span>:</span><br><span class="line">            <span class="built_in">WinSock</span>()</span><br><span class="line">            &#123;</span><br><span class="line">                WSADATA wsaData;</span><br><span class="line">                <span class="type">const</span> <span class="keyword">auto</span> error = <span class="built_in">WSAStartup</span>(<span class="built_in">MAKEWORD</span>(<span class="number">2</span>, <span class="number">2</span>), &amp;wsaData);</span><br><span class="line">                <span class="keyword">if</span> (error != <span class="number">0</span>)</span><br><span class="line">                    <span class="keyword">throw</span> std::system_error&#123;error, std::<span class="built_in">system_category</span>(), <span class="string">&quot;WSAStartup failed&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">LOBYTE</span>(wsaData.wVersion) != <span class="number">2</span> || <span class="built_in">HIBYTE</span>(wsaData.wVersion) != <span class="number">2</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">WSACleanup</span>();</span><br><span class="line">                    <span class="keyword">throw</span> std::runtime_error&#123;<span class="string">&quot;Invalid WinSock version&quot;</span>&#125;;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                started = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ~<span class="built_in">WinSock</span>()</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (started) <span class="built_in">WSACleanup</span>();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">WinSock</span>(WinSock&amp;&amp; other) <span class="keyword">noexcept</span>:</span><br><span class="line">                started&#123;other.started&#125;</span><br><span class="line">            &#123;</span><br><span class="line">                other.started = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            WinSock&amp; <span class="keyword">operator</span>=(WinSock&amp;&amp; other) <span class="keyword">noexcept</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (&amp;other == <span class="keyword">this</span>) <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">                <span class="keyword">if</span> (started) <span class="built_in">WSACleanup</span>();</span><br><span class="line">                started = other.started;</span><br><span class="line">                other.started = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span>:</span><br><span class="line">            <span class="type">bool</span> started = <span class="literal">false</span>;</span><br><span class="line">        &#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// defined(_WIN32) || defined(__CYGWIN__)</span></span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">getLastError</span><span class="params">()</span> <span class="keyword">noexcept</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(_WIN32) || defined(__CYGWIN__)</span></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">WSAGetLastError</span>();</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">            <span class="keyword">return</span> errno;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// defined(_WIN32) || defined(__CYGWIN__)</span></span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">constexpr</span> <span class="type">int</span> <span class="title">getAddressFamily</span><span class="params">(<span class="type">const</span> InternetProtocol internetProtocol)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> (internetProtocol == InternetProtocol::V4) ? AF_INET :</span><br><span class="line">                (internetProtocol == InternetProtocol::V6) ? AF_INET6 :</span><br><span class="line">                <span class="keyword">throw</span> RequestError&#123;<span class="string">&quot;Unsupported protocol&quot;</span>&#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">Socket</span> <span class="keyword">final</span></span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">public</span>:</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(_WIN32) || defined(__CYGWIN__)</span></span><br><span class="line">            <span class="keyword">using</span> Type = SOCKET;</span><br><span class="line">            <span class="type">static</span> <span class="keyword">constexpr</span> Type invalid = INVALID_SOCKET;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">            <span class="keyword">using</span> Type = <span class="type">int</span>;</span><br><span class="line">            <span class="type">static</span> <span class="keyword">constexpr</span> Type invalid = <span class="number">-1</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// defined(_WIN32) || defined(__CYGWIN__)</span></span></span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">explicit</span> <span class="title">Socket</span><span class="params">(<span class="type">const</span> InternetProtocol internetProtocol)</span>:</span></span><br><span class="line"><span class="function">                endpoint&#123;</span><span class="built_in">socket</span>(<span class="built_in">getAddressFamily</span>(internetProtocol), SOCK_STREAM, IPPROTO_TCP)&#125;</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (endpoint == invalid)</span><br><span class="line">                    <span class="keyword">throw</span> std::system_error&#123;<span class="built_in">getLastError</span>(), std::<span class="built_in">system_category</span>(), <span class="string">&quot;Failed to create socket&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(_WIN32) || defined(__CYGWIN__)</span></span><br><span class="line">                ULONG mode = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">ioctlsocket</span>(endpoint, FIONBIO, &amp;mode) != <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">close</span>();</span><br><span class="line">                    <span class="keyword">throw</span> std::system_error&#123;<span class="built_in">WSAGetLastError</span>(), std::<span class="built_in">system_category</span>(), <span class="string">&quot;Failed to get socket flags&quot;</span>&#125;;</span><br><span class="line">                &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">                <span class="type">const</span> <span class="keyword">auto</span> flags = <span class="built_in">fcntl</span>(endpoint, F_GETFL);</span><br><span class="line">                <span class="keyword">if</span> (flags == <span class="number">-1</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">close</span>();</span><br><span class="line">                    <span class="keyword">throw</span> std::system_error&#123;errno, std::<span class="built_in">system_category</span>(), <span class="string">&quot;Failed to get socket flags&quot;</span>&#125;;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">fcntl</span>(endpoint, F_SETFL, flags | O_NONBLOCK) == <span class="number">-1</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">close</span>();</span><br><span class="line">                    <span class="keyword">throw</span> std::system_error&#123;errno, std::<span class="built_in">system_category</span>(), <span class="string">&quot;Failed to set socket flags&quot;</span>&#125;;</span><br><span class="line">                &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// defined(_WIN32) || defined(__CYGWIN__)</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __APPLE__</span></span><br><span class="line">                <span class="type">const</span> <span class="type">int</span> value = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">setsockopt</span>(endpoint, SOL_SOCKET, SO_NOSIGPIPE, &amp;value, <span class="built_in">sizeof</span>(value)) == <span class="number">-1</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">close</span>();</span><br><span class="line">                    <span class="keyword">throw</span> std::system_error&#123;errno, std::<span class="built_in">system_category</span>(), <span class="string">&quot;Failed to set socket option&quot;</span>&#125;;</span><br><span class="line">                &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// __APPLE__</span></span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ~<span class="built_in">Socket</span>()</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (endpoint != invalid) <span class="built_in">close</span>();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">Socket</span>(Socket&amp;&amp; other) <span class="keyword">noexcept</span>:</span><br><span class="line">                endpoint&#123;other.endpoint&#125;</span><br><span class="line">            &#123;</span><br><span class="line">                other.endpoint = invalid;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Socket&amp; <span class="keyword">operator</span>=(Socket&amp;&amp; other) <span class="keyword">noexcept</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (&amp;other == <span class="keyword">this</span>) <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">                <span class="keyword">if</span> (endpoint != invalid) <span class="built_in">close</span>();</span><br><span class="line">                endpoint = other.endpoint;</span><br><span class="line">                other.endpoint = invalid;</span><br><span class="line">                <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="type">void</span> <span class="title">connect</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> sockaddr* address, <span class="type">const</span> <span class="type">socklen_t</span> addressSize, <span class="type">const</span> std::<span class="type">int64_t</span> timeout)</span></span></span><br><span class="line"><span class="function">            </span>&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(_WIN32) || defined(__CYGWIN__)</span></span><br><span class="line">                <span class="keyword">auto</span> result = ::<span class="built_in">connect</span>(endpoint, address, addressSize);</span><br><span class="line">                <span class="keyword">while</span> (result == <span class="number">-1</span> &amp;&amp; <span class="built_in">WSAGetLastError</span>() == WSAEINTR)</span><br><span class="line">                    result = ::<span class="built_in">connect</span>(endpoint, address, addressSize);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (result == <span class="number">-1</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="built_in">WSAGetLastError</span>() == WSAEWOULDBLOCK)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="built_in">select</span>(SelectType::write, timeout);</span><br><span class="line"></span><br><span class="line">                        <span class="type">char</span> socketErrorPointer[<span class="built_in">sizeof</span>(<span class="type">int</span>)];</span><br><span class="line">                        <span class="type">socklen_t</span> optionLength = <span class="built_in">sizeof</span>(socketErrorPointer);</span><br><span class="line">                        <span class="keyword">if</span> (<span class="built_in">getsockopt</span>(endpoint, SOL_SOCKET, SO_ERROR, socketErrorPointer, &amp;optionLength) == <span class="number">-1</span>)</span><br><span class="line">                            <span class="keyword">throw</span> std::system_error&#123;<span class="built_in">WSAGetLastError</span>(), std::<span class="built_in">system_category</span>(), <span class="string">&quot;Failed to get socket option&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">                        <span class="type">int</span> socketError;</span><br><span class="line">                        std::<span class="built_in">memcpy</span>(&amp;socketError, socketErrorPointer, <span class="built_in">sizeof</span>(socketErrorPointer));</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (socketError != <span class="number">0</span>)</span><br><span class="line">                            <span class="keyword">throw</span> std::system_error&#123;socketError, std::<span class="built_in">system_category</span>(), <span class="string">&quot;Failed to connect&quot;</span>&#125;;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        <span class="keyword">throw</span> std::system_error&#123;<span class="built_in">WSAGetLastError</span>(), std::<span class="built_in">system_category</span>(), <span class="string">&quot;Failed to connect&quot;</span>&#125;;</span><br><span class="line">                &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">                <span class="keyword">auto</span> result = ::<span class="built_in">connect</span>(endpoint, address, addressSize);</span><br><span class="line">                <span class="keyword">while</span> (result == <span class="number">-1</span> &amp;&amp; errno == EINTR)</span><br><span class="line">                    result = ::<span class="built_in">connect</span>(endpoint, address, addressSize);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (result == <span class="number">-1</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span> (errno == EINPROGRESS)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="built_in">select</span>(SelectType::write, timeout);</span><br><span class="line"></span><br><span class="line">                        <span class="type">int</span> socketError;</span><br><span class="line">                        <span class="type">socklen_t</span> optionLength = <span class="built_in">sizeof</span>(socketError);</span><br><span class="line">                        <span class="keyword">if</span> (<span class="built_in">getsockopt</span>(endpoint, SOL_SOCKET, SO_ERROR, &amp;socketError, &amp;optionLength) == <span class="number">-1</span>)</span><br><span class="line">                            <span class="keyword">throw</span> std::system_error&#123;errno, std::<span class="built_in">system_category</span>(), <span class="string">&quot;Failed to get socket option&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (socketError != <span class="number">0</span>)</span><br><span class="line">                            <span class="keyword">throw</span> std::system_error&#123;socketError, std::<span class="built_in">system_category</span>(), <span class="string">&quot;Failed to connect&quot;</span>&#125;;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        <span class="keyword">throw</span> std::system_error&#123;errno, std::<span class="built_in">system_category</span>(), <span class="string">&quot;Failed to connect&quot;</span>&#125;;</span><br><span class="line">                &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// defined(_WIN32) || defined(__CYGWIN__)</span></span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function">std::<span class="type">size_t</span> <span class="title">send</span><span class="params">(<span class="type">const</span> <span class="type">void</span>* buffer, <span class="type">const</span> std::<span class="type">size_t</span> length, <span class="type">const</span> std::<span class="type">int64_t</span> timeout)</span></span></span><br><span class="line"><span class="function">            </span>&#123;</span><br><span class="line">                <span class="built_in">select</span>(SelectType::write, timeout);</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(_WIN32) || defined(__CYGWIN__)</span></span><br><span class="line">                <span class="keyword">auto</span> result = ::<span class="built_in">send</span>(endpoint, <span class="built_in">reinterpret_cast</span>&lt;<span class="type">const</span> <span class="type">char</span>*&gt;(buffer),</span><br><span class="line">                                     <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(length), <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">while</span> (result == <span class="number">-1</span> &amp;&amp; <span class="built_in">WSAGetLastError</span>() == WSAEINTR)</span><br><span class="line">                    result = ::<span class="built_in">send</span>(endpoint, <span class="built_in">reinterpret_cast</span>&lt;<span class="type">const</span> <span class="type">char</span>*&gt;(buffer),</span><br><span class="line">                                    <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(length), <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (result == <span class="number">-1</span>)</span><br><span class="line">                    <span class="keyword">throw</span> std::system_error&#123;<span class="built_in">WSAGetLastError</span>(), std::<span class="built_in">system_category</span>(), <span class="string">&quot;Failed to send data&quot;</span>&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">                <span class="keyword">auto</span> result = ::<span class="built_in">send</span>(endpoint, <span class="built_in">reinterpret_cast</span>&lt;<span class="type">const</span> <span class="type">char</span>*&gt;(buffer),</span><br><span class="line">                                     length, noSignal);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">while</span> (result == <span class="number">-1</span> &amp;&amp; errno == EINTR)</span><br><span class="line">                    result = ::<span class="built_in">send</span>(endpoint, <span class="built_in">reinterpret_cast</span>&lt;<span class="type">const</span> <span class="type">char</span>*&gt;(buffer),</span><br><span class="line">                                    length, noSignal);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (result == <span class="number">-1</span>)</span><br><span class="line">                    <span class="keyword">throw</span> std::system_error&#123;errno, std::<span class="built_in">system_category</span>(), <span class="string">&quot;Failed to send data&quot;</span>&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// defined(_WIN32) || defined(__CYGWIN__)</span></span></span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">static_cast</span>&lt;std::<span class="type">size_t</span>&gt;(result);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function">std::<span class="type">size_t</span> <span class="title">recv</span><span class="params">(<span class="type">void</span>* buffer, <span class="type">const</span> std::<span class="type">size_t</span> length, <span class="type">const</span> std::<span class="type">int64_t</span> timeout)</span></span></span><br><span class="line"><span class="function">            </span>&#123;</span><br><span class="line">                <span class="built_in">select</span>(SelectType::read, timeout);</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(_WIN32) || defined(__CYGWIN__)</span></span><br><span class="line">                <span class="keyword">auto</span> result = ::<span class="built_in">recv</span>(endpoint, <span class="built_in">reinterpret_cast</span>&lt;<span class="type">char</span>*&gt;(buffer),</span><br><span class="line">                                     <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(length), <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">while</span> (result == <span class="number">-1</span> &amp;&amp; <span class="built_in">WSAGetLastError</span>() == WSAEINTR)</span><br><span class="line">                    result = ::<span class="built_in">recv</span>(endpoint, <span class="built_in">reinterpret_cast</span>&lt;<span class="type">char</span>*&gt;(buffer),</span><br><span class="line">                                    <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(length), <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (result == <span class="number">-1</span>)</span><br><span class="line">                    <span class="keyword">throw</span> std::system_error&#123;<span class="built_in">WSAGetLastError</span>(), std::<span class="built_in">system_category</span>(), <span class="string">&quot;Failed to read data&quot;</span>&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">                <span class="keyword">auto</span> result = ::<span class="built_in">recv</span>(endpoint, <span class="built_in">reinterpret_cast</span>&lt;<span class="type">char</span>*&gt;(buffer),</span><br><span class="line">                                     length, noSignal);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">while</span> (result == <span class="number">-1</span> &amp;&amp; errno == EINTR)</span><br><span class="line">                    result = ::<span class="built_in">recv</span>(endpoint, <span class="built_in">reinterpret_cast</span>&lt;<span class="type">char</span>*&gt;(buffer),</span><br><span class="line">                                    length, noSignal);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (result == <span class="number">-1</span>)</span><br><span class="line">                    <span class="keyword">throw</span> std::system_error&#123;errno, std::<span class="built_in">system_category</span>(), <span class="string">&quot;Failed to read data&quot;</span>&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// defined(_WIN32) || defined(__CYGWIN__)</span></span></span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">static_cast</span>&lt;std::<span class="type">size_t</span>&gt;(result);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span>:</span><br><span class="line">            <span class="keyword">enum class</span> <span class="title class_">SelectType</span></span><br><span class="line">            &#123;</span><br><span class="line">                read,</span><br><span class="line">                write</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="type">void</span> <span class="title">select</span><span class="params">(<span class="type">const</span> SelectType type, <span class="type">const</span> std::<span class="type">int64_t</span> timeout)</span></span></span><br><span class="line"><span class="function">            </span>&#123;</span><br><span class="line">                fd_set descriptorSet;</span><br><span class="line">                <span class="built_in">FD_ZERO</span>(&amp;descriptorSet);</span><br><span class="line">                <span class="built_in">FD_SET</span>(endpoint, &amp;descriptorSet);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(_WIN32) || defined(__CYGWIN__)</span></span><br><span class="line">                TIMEVAL selectTimeout&#123;</span><br><span class="line">                    <span class="built_in">static_cast</span>&lt;LONG&gt;(timeout / <span class="number">1000</span>),</span><br><span class="line">                    <span class="built_in">static_cast</span>&lt;LONG&gt;((timeout % <span class="number">1000</span>) * <span class="number">1000</span>)</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="keyword">auto</span> count = ::<span class="built_in">select</span>(<span class="number">0</span>,</span><br><span class="line">                                      (type == SelectType::read) ? &amp;descriptorSet : <span class="literal">nullptr</span>,</span><br><span class="line">                                      (type == SelectType::write) ? &amp;descriptorSet : <span class="literal">nullptr</span>,</span><br><span class="line">                                      <span class="literal">nullptr</span>,</span><br><span class="line">                                      (timeout &gt;= <span class="number">0</span>) ? &amp;selectTimeout : <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">while</span> (count == <span class="number">-1</span> &amp;&amp; <span class="built_in">WSAGetLastError</span>() == WSAEINTR)</span><br><span class="line">                    count = ::<span class="built_in">select</span>(<span class="number">0</span>,</span><br><span class="line">                                     (type == SelectType::read) ? &amp;descriptorSet : <span class="literal">nullptr</span>,</span><br><span class="line">                                     (type == SelectType::write) ? &amp;descriptorSet : <span class="literal">nullptr</span>,</span><br><span class="line">                                     <span class="literal">nullptr</span>,</span><br><span class="line">                                     (timeout &gt;= <span class="number">0</span>) ? &amp;selectTimeout : <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (count == <span class="number">-1</span>)</span><br><span class="line">                    <span class="keyword">throw</span> std::system_error&#123;<span class="built_in">WSAGetLastError</span>(), std::<span class="built_in">system_category</span>(), <span class="string">&quot;Failed to select socket&quot;</span>&#125;;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (count == <span class="number">0</span>)</span><br><span class="line">                    <span class="keyword">throw</span> ResponseError&#123;<span class="string">&quot;Request timed out&quot;</span>&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">                timeval selectTimeout&#123;</span><br><span class="line">                    <span class="built_in">static_cast</span>&lt;<span class="type">time_t</span>&gt;(timeout / <span class="number">1000</span>),</span><br><span class="line">                    <span class="built_in">static_cast</span>&lt;<span class="type">suseconds_t</span>&gt;((timeout % <span class="number">1000</span>) * <span class="number">1000</span>)</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="keyword">auto</span> count = ::<span class="built_in">select</span>(endpoint + <span class="number">1</span>,</span><br><span class="line">                                      (type == SelectType::read) ? &amp;descriptorSet : <span class="literal">nullptr</span>,</span><br><span class="line">                                      (type == SelectType::write) ? &amp;descriptorSet : <span class="literal">nullptr</span>,</span><br><span class="line">                                      <span class="literal">nullptr</span>,</span><br><span class="line">                                      (timeout &gt;= <span class="number">0</span>) ? &amp;selectTimeout : <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">while</span> (count == <span class="number">-1</span> &amp;&amp; errno == EINTR)</span><br><span class="line">                    count = ::<span class="built_in">select</span>(endpoint + <span class="number">1</span>,</span><br><span class="line">                                     (type == SelectType::read) ? &amp;descriptorSet : <span class="literal">nullptr</span>,</span><br><span class="line">                                     (type == SelectType::write) ? &amp;descriptorSet : <span class="literal">nullptr</span>,</span><br><span class="line">                                     <span class="literal">nullptr</span>,</span><br><span class="line">                                     (timeout &gt;= <span class="number">0</span>) ? &amp;selectTimeout : <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (count == <span class="number">-1</span>)</span><br><span class="line">                    <span class="keyword">throw</span> std::system_error&#123;errno, std::<span class="built_in">system_category</span>(), <span class="string">&quot;Failed to select socket&quot;</span>&#125;;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (count == <span class="number">0</span>)</span><br><span class="line">                    <span class="keyword">throw</span> ResponseError&#123;<span class="string">&quot;Request timed out&quot;</span>&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// defined(_WIN32) || defined(__CYGWIN__)</span></span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="type">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">noexcept</span></span></span><br><span class="line"><span class="function">            </span>&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(_WIN32) || defined(__CYGWIN__)</span></span><br><span class="line">                <span class="built_in">closesocket</span>(endpoint);</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">                ::<span class="built_in">close</span>(endpoint);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// defined(_WIN32) || defined(__CYGWIN__)</span></span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(__unix__) &amp;&amp; !defined(__APPLE__) &amp;&amp; !defined(__CYGWIN__)</span></span><br><span class="line">            <span class="type">static</span> <span class="keyword">constexpr</span> <span class="type">int</span> noSignal = MSG_NOSIGNAL;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">            <span class="type">static</span> <span class="keyword">constexpr</span> <span class="type">int</span> noSignal = <span class="number">0</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// defined(__unix__) &amp;&amp; !defined(__APPLE__)</span></span></span><br><span class="line"></span><br><span class="line">            Type endpoint = invalid;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// RFC 7230, 3.2.3. WhiteSpace</span></span><br><span class="line">        <span class="keyword">template</span> &lt;<span class="keyword">typename</span> C&gt;</span><br><span class="line">        <span class="function"><span class="keyword">constexpr</span> <span class="type">bool</span> <span class="title">isWhiteSpaceChar</span><span class="params">(<span class="type">const</span> C c)</span> <span class="keyword">noexcept</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> c == <span class="number">0x20</span> || c == <span class="number">0x09</span>; <span class="comment">// space or tab</span></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// RFC 5234, Appendix B.1. Core Rules</span></span><br><span class="line">        <span class="keyword">template</span> &lt;<span class="keyword">typename</span> C&gt;</span><br><span class="line">        <span class="function"><span class="keyword">constexpr</span> <span class="type">bool</span> <span class="title">isDigitChar</span><span class="params">(<span class="type">const</span> C c)</span> <span class="keyword">noexcept</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> c &gt;= <span class="number">0x30</span> &amp;&amp; c &lt;= <span class="number">0x39</span>; <span class="comment">// 0 - 9</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// RFC 5234, Appendix B.1. Core Rules</span></span><br><span class="line">        <span class="keyword">template</span> &lt;<span class="keyword">typename</span> C&gt;</span><br><span class="line">        <span class="function"><span class="keyword">constexpr</span> <span class="type">bool</span> <span class="title">isAlphaChar</span><span class="params">(<span class="type">const</span> C c)</span> <span class="keyword">noexcept</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">                (c &gt;= <span class="number">0x61</span> &amp;&amp; c &lt;= <span class="number">0x7A</span>) || <span class="comment">// a - z</span></span><br><span class="line">                (c &gt;= <span class="number">0x41</span> &amp;&amp; c &lt;= <span class="number">0x5A</span>); <span class="comment">// A - Z</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// RFC 7230, 3.2.6. Field Value Components</span></span><br><span class="line">        <span class="keyword">template</span> &lt;<span class="keyword">typename</span> C&gt;</span><br><span class="line">        <span class="function"><span class="keyword">constexpr</span> <span class="type">bool</span> <span class="title">isTokenChar</span><span class="params">(<span class="type">const</span> C c)</span> <span class="keyword">noexcept</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> c == <span class="number">0x21</span> || <span class="comment">// !</span></span><br><span class="line">                c == <span class="number">0x23</span> || <span class="comment">// #</span></span><br><span class="line">                c == <span class="number">0x24</span> || <span class="comment">// $</span></span><br><span class="line">                c == <span class="number">0x25</span> || <span class="comment">// %</span></span><br><span class="line">                c == <span class="number">0x26</span> || <span class="comment">// &amp;</span></span><br><span class="line">                c == <span class="number">0x27</span> || <span class="comment">// &#x27;</span></span><br><span class="line">                c == <span class="number">0x2A</span> || <span class="comment">// *</span></span><br><span class="line">                c == <span class="number">0x2B</span> || <span class="comment">// +</span></span><br><span class="line">                c == <span class="number">0x2D</span> || <span class="comment">// -</span></span><br><span class="line">                c == <span class="number">0x2E</span> || <span class="comment">// .</span></span><br><span class="line">                c == <span class="number">0x5E</span> || <span class="comment">// ^</span></span><br><span class="line">                c == <span class="number">0x5F</span> || <span class="comment">// _</span></span><br><span class="line">                c == <span class="number">0x60</span> || <span class="comment">// `</span></span><br><span class="line">                c == <span class="number">0x7C</span> || <span class="comment">// |</span></span><br><span class="line">                c == <span class="number">0x7E</span> || <span class="comment">// ~</span></span><br><span class="line">                <span class="built_in">isDigitChar</span>(c) ||</span><br><span class="line">                <span class="built_in">isAlphaChar</span>(c);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// RFC 5234, Appendix B.1. Core Rules</span></span><br><span class="line">        <span class="keyword">template</span> &lt;<span class="keyword">typename</span> C&gt;</span><br><span class="line">        <span class="function"><span class="keyword">constexpr</span> <span class="type">bool</span> <span class="title">isVisibleChar</span><span class="params">(<span class="type">const</span> C c)</span> <span class="keyword">noexcept</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> c &gt;= <span class="number">0x21</span> &amp;&amp; c &lt;= <span class="number">0x7E</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// RFC 7230, Appendix B. Collected ABNF</span></span><br><span class="line">        <span class="keyword">template</span> &lt;<span class="keyword">typename</span> C&gt;</span><br><span class="line">        <span class="function"><span class="keyword">constexpr</span> <span class="type">bool</span> <span class="title">isObsoleteTextChar</span><span class="params">(<span class="type">const</span> C c)</span> <span class="keyword">noexcept</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">static_cast</span>&lt;<span class="type">unsigned</span> <span class="type">char</span>&gt;(c) &gt;= <span class="number">0x80</span> &amp;&amp;</span><br><span class="line">                <span class="built_in">static_cast</span>&lt;<span class="type">unsigned</span> <span class="type">char</span>&gt;(c) &lt;= <span class="number">0xFF</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Iterator</span>&gt;</span><br><span class="line">        <span class="function">Iterator <span class="title">skipWhiteSpaces</span><span class="params">(<span class="type">const</span> Iterator begin, <span class="type">const</span> Iterator end)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">auto</span> i = begin;</span><br><span class="line">            <span class="keyword">for</span> (i = begin; i != end; ++i)</span><br><span class="line">                <span class="keyword">if</span> (!<span class="built_in">isWhiteSpaceChar</span>(*i))</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> i;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// RFC 5234, Appendix B.1. Core Rules</span></span><br><span class="line">        <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> C, <span class="keyword">typename</span> std::enable_if&lt;std::is_unsigned&lt;T&gt;::value&gt;::type* = <span class="literal">nullptr</span>&gt;</span><br><span class="line">        <span class="keyword">constexpr</span> T <span class="built_in">digitToUint</span>(<span class="type">const</span> C c)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// DIGIT</span></span><br><span class="line">            <span class="built_in">return</span> (c &gt;= <span class="number">0x30</span> &amp;&amp; c &lt;= <span class="number">0x39</span>) ? <span class="built_in">static_cast</span>&lt;T&gt;(c - <span class="number">0x30</span>) : <span class="comment">// 0 - 9</span></span><br><span class="line">                <span class="keyword">throw</span> ResponseError&#123;<span class="string">&quot;Invalid digit&quot;</span>&#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// RFC 5234, Appendix B.1. Core Rules</span></span><br><span class="line">        <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> C, <span class="keyword">typename</span> std::enable_if&lt;std::is_unsigned&lt;T&gt;::value&gt;::type* = <span class="literal">nullptr</span>&gt;</span><br><span class="line">        <span class="keyword">constexpr</span> T <span class="built_in">hexDigitToUint</span>(<span class="type">const</span> C c)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// HEXDIG</span></span><br><span class="line">            <span class="built_in">return</span> (c &gt;= <span class="number">0x30</span> &amp;&amp; c &lt;= <span class="number">0x39</span>) ? <span class="built_in">static_cast</span>&lt;T&gt;(c - <span class="number">0x30</span>) : <span class="comment">// 0 - 9</span></span><br><span class="line">                (c &gt;= <span class="number">0x41</span> &amp;&amp; c &lt;= <span class="number">0x46</span>) ? <span class="built_in">static_cast</span>&lt;T&gt;(c - <span class="number">0x41</span>) + <span class="built_in">T</span>(<span class="number">10</span>) : <span class="comment">// A - Z</span></span><br><span class="line">                (c &gt;= <span class="number">0x61</span> &amp;&amp; c &lt;= <span class="number">0x66</span>) ? <span class="built_in">static_cast</span>&lt;T&gt;(c - <span class="number">0x61</span>) + <span class="built_in">T</span>(<span class="number">10</span>) : <span class="comment">// a - z, some services send lower-case hex digits</span></span><br><span class="line">                <span class="keyword">throw</span> ResponseError&#123;<span class="string">&quot;Invalid hex digit&quot;</span>&#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// RFC 3986, 3. Syntax Components</span></span><br><span class="line">        <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Iterator</span>&gt;</span><br><span class="line">        <span class="function">Uri <span class="title">parseUri</span><span class="params">(<span class="type">const</span> Iterator begin, <span class="type">const</span> Iterator end)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            Uri result;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// RFC 3986, 3.1. Scheme</span></span><br><span class="line">            <span class="keyword">auto</span> i = begin;</span><br><span class="line">            <span class="keyword">if</span> (i == end || !<span class="built_in">isAlphaChar</span>(*begin))</span><br><span class="line">                <span class="keyword">throw</span> RequestError&#123;<span class="string">&quot;Invalid scheme&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">            result.scheme.<span class="built_in">push_back</span>(*i++);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (; i != end &amp;&amp; (<span class="built_in">isAlphaChar</span>(*i) || <span class="built_in">isDigitChar</span>(*i) || *i == <span class="string">&#x27;+&#x27;</span> || *i == <span class="string">&#x27;-&#x27;</span> || *i == <span class="string">&#x27;.&#x27;</span>); ++i)</span><br><span class="line">                result.scheme.<span class="built_in">push_back</span>(*i);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (i == end || *i++ != <span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">                <span class="keyword">throw</span> RequestError&#123;<span class="string">&quot;Invalid scheme&quot;</span>&#125;;</span><br><span class="line">            <span class="keyword">if</span> (i == end || *i++ != <span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">                <span class="keyword">throw</span> RequestError&#123;<span class="string">&quot;Invalid scheme&quot;</span>&#125;;</span><br><span class="line">            <span class="keyword">if</span> (i == end || *i++ != <span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">                <span class="keyword">throw</span> RequestError&#123;<span class="string">&quot;Invalid scheme&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// RFC 3986, 3.2. Authority</span></span><br><span class="line">            std::string authority = std::<span class="built_in">string</span>(i, end);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// RFC 3986, 3.5. Fragment</span></span><br><span class="line">            <span class="type">const</span> <span class="keyword">auto</span> fragmentPosition = authority.<span class="built_in">find</span>(<span class="string">&#x27;#&#x27;</span>);</span><br><span class="line">            <span class="keyword">if</span> (fragmentPosition != std::string::npos)</span><br><span class="line">            &#123;</span><br><span class="line">                result.fragment = authority.<span class="built_in">substr</span>(fragmentPosition + <span class="number">1</span>);</span><br><span class="line">                authority.<span class="built_in">resize</span>(fragmentPosition); <span class="comment">// remove the fragment part</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// RFC 3986, 3.4. Query</span></span><br><span class="line">            <span class="type">const</span> <span class="keyword">auto</span> queryPosition = authority.<span class="built_in">find</span>(<span class="string">&#x27;?&#x27;</span>);</span><br><span class="line">            <span class="keyword">if</span> (queryPosition != std::string::npos)</span><br><span class="line">            &#123;</span><br><span class="line">                result.query = authority.<span class="built_in">substr</span>(queryPosition + <span class="number">1</span>);</span><br><span class="line">                authority.<span class="built_in">resize</span>(queryPosition); <span class="comment">// remove the query part</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// RFC 3986, 3.3. Path</span></span><br><span class="line">            <span class="type">const</span> <span class="keyword">auto</span> pathPosition = authority.<span class="built_in">find</span>(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">            <span class="keyword">if</span> (pathPosition != std::string::npos)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// RFC 3986, 3.3. Path</span></span><br><span class="line">                result.path = authority.<span class="built_in">substr</span>(pathPosition);</span><br><span class="line">                authority.<span class="built_in">resize</span>(pathPosition);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                result.path = <span class="string">&quot;/&quot;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// RFC 3986, 3.2.1. User Information</span></span><br><span class="line">            std::string userinfo;</span><br><span class="line">            <span class="type">const</span> <span class="keyword">auto</span> hostPosition = authority.<span class="built_in">find</span>(<span class="string">&#x27;@&#x27;</span>);</span><br><span class="line">            <span class="keyword">if</span> (hostPosition != std::string::npos)</span><br><span class="line">            &#123;</span><br><span class="line">                userinfo = authority.<span class="built_in">substr</span>(<span class="number">0</span>, hostPosition);</span><br><span class="line"></span><br><span class="line">                <span class="type">const</span> <span class="keyword">auto</span> passwordPosition = userinfo.<span class="built_in">find</span>(<span class="string">&#x27;:&#x27;</span>);</span><br><span class="line">                <span class="keyword">if</span> (passwordPosition != std::string::npos)</span><br><span class="line">                &#123;</span><br><span class="line">                    result.user = userinfo.<span class="built_in">substr</span>(<span class="number">0</span>, passwordPosition);</span><br><span class="line">                    result.password = userinfo.<span class="built_in">substr</span>(passwordPosition + <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    result.user = userinfo;</span><br><span class="line"></span><br><span class="line">                result.host = authority.<span class="built_in">substr</span>(hostPosition + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                result.host = authority;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// RFC 3986, 3.2.2. Host</span></span><br><span class="line">            <span class="type">const</span> <span class="keyword">auto</span> portPosition = result.host.<span class="built_in">find</span>(<span class="string">&#x27;:&#x27;</span>);</span><br><span class="line">            <span class="keyword">if</span> (portPosition != std::string::npos)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// RFC 3986, 3.2.3. Port</span></span><br><span class="line">                result.port = result.host.<span class="built_in">substr</span>(portPosition + <span class="number">1</span>);</span><br><span class="line">                result.host.<span class="built_in">resize</span>(portPosition);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// RFC 7230, 2.6. Protocol Versioning</span></span><br><span class="line">        <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Iterator</span>&gt;</span><br><span class="line">        <span class="function">std::pair&lt;Iterator, HttpVersion&gt; <span class="title">parseHttpVersion</span><span class="params">(<span class="type">const</span> Iterator begin, <span class="type">const</span> Iterator end)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">auto</span> i = begin;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (i == end || *i++ != <span class="string">&#x27;H&#x27;</span>)</span><br><span class="line">                <span class="keyword">throw</span> ResponseError&#123;<span class="string">&quot;Invalid HTTP version&quot;</span>&#125;;</span><br><span class="line">            <span class="keyword">if</span> (i == end || *i++ != <span class="string">&#x27;T&#x27;</span>)</span><br><span class="line">                <span class="keyword">throw</span> ResponseError&#123;<span class="string">&quot;Invalid HTTP version&quot;</span>&#125;;</span><br><span class="line">            <span class="keyword">if</span> (i == end || *i++ != <span class="string">&#x27;T&#x27;</span>)</span><br><span class="line">                <span class="keyword">throw</span> ResponseError&#123;<span class="string">&quot;Invalid HTTP version&quot;</span>&#125;;</span><br><span class="line">            <span class="keyword">if</span> (i == end || *i++ != <span class="string">&#x27;P&#x27;</span>)</span><br><span class="line">                <span class="keyword">throw</span> ResponseError&#123;<span class="string">&quot;Invalid HTTP version&quot;</span>&#125;;</span><br><span class="line">            <span class="keyword">if</span> (i == end || *i++ != <span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">                <span class="keyword">throw</span> ResponseError&#123;<span class="string">&quot;Invalid HTTP version&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (i == end)</span><br><span class="line">                <span class="keyword">throw</span> ResponseError&#123;<span class="string">&quot;Invalid HTTP version&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">            <span class="type">const</span> <span class="keyword">auto</span> majorVersion = <span class="built_in">digitToUint</span>&lt;std::<span class="type">uint16_t</span>&gt;(*i++);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (i == end || *i++ != <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">                <span class="keyword">throw</span> ResponseError&#123;<span class="string">&quot;Invalid HTTP version&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (i == end)</span><br><span class="line">                <span class="keyword">throw</span> ResponseError&#123;<span class="string">&quot;Invalid HTTP version&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">            <span class="type">const</span> <span class="keyword">auto</span> minorVersion = <span class="built_in">digitToUint</span>&lt;std::<span class="type">uint16_t</span>&gt;(*i++);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> &#123;i, HttpVersion&#123;majorVersion, minorVersion&#125;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// RFC 7230, 3.1.2. Status Line</span></span><br><span class="line">        <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Iterator</span>&gt;</span><br><span class="line">        <span class="function">std::pair&lt;Iterator, std::<span class="type">uint16_t</span>&gt; <span class="title">parseStatusCode</span><span class="params">(<span class="type">const</span> Iterator begin, <span class="type">const</span> Iterator end)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            std::<span class="type">uint16_t</span> result = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">auto</span> i = begin;</span><br><span class="line">            <span class="keyword">while</span> (i != end &amp;&amp; <span class="built_in">isDigitChar</span>(*i))</span><br><span class="line">                result = <span class="built_in">static_cast</span>&lt;std::<span class="type">uint16_t</span>&gt;(result * <span class="number">10U</span>) + <span class="built_in">digitToUint</span>&lt;std::<span class="type">uint16_t</span>&gt;(*i++);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (std::<span class="built_in">distance</span>(begin, i) != <span class="number">3</span>)</span><br><span class="line">                <span class="keyword">throw</span> ResponseError&#123;<span class="string">&quot;Invalid status code&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> &#123;i, result&#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// RFC 7230, 3.1.2. Status Line</span></span><br><span class="line">        <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Iterator</span>&gt;</span><br><span class="line">        <span class="function">std::pair&lt;Iterator, std::string&gt; <span class="title">parseReasonPhrase</span><span class="params">(<span class="type">const</span> Iterator begin, <span class="type">const</span> Iterator end)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            std::string result;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">auto</span> i = begin;</span><br><span class="line">            <span class="keyword">for</span> (; i != end &amp;&amp; (<span class="built_in">isWhiteSpaceChar</span>(*i) || <span class="built_in">isVisibleChar</span>(*i) || <span class="built_in">isObsoleteTextChar</span>(*i)); ++i)</span><br><span class="line">                result.<span class="built_in">push_back</span>(<span class="built_in">static_cast</span>&lt;<span class="type">char</span>&gt;(*i));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> &#123;i, std::<span class="built_in">move</span>(result)&#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// RFC 7230, 3.2.6. Field Value Components</span></span><br><span class="line">        <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Iterator</span>&gt;</span><br><span class="line">        <span class="function">std::pair&lt;Iterator, std::string&gt; <span class="title">parseToken</span><span class="params">(<span class="type">const</span> Iterator begin, <span class="type">const</span> Iterator end)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            std::string result;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">auto</span> i = begin;</span><br><span class="line">            <span class="keyword">for</span> (; i != end &amp;&amp; <span class="built_in">isTokenChar</span>(*i); ++i)</span><br><span class="line">                result.<span class="built_in">push_back</span>(<span class="built_in">static_cast</span>&lt;<span class="type">char</span>&gt;(*i));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (result.<span class="built_in">empty</span>())</span><br><span class="line">                <span class="keyword">throw</span> ResponseError&#123;<span class="string">&quot;Invalid token&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> &#123;i, std::<span class="built_in">move</span>(result)&#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// RFC 7230, 3.2. Header Fields</span></span><br><span class="line">        <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Iterator</span>&gt;</span><br><span class="line">        <span class="function">std::pair&lt;Iterator, std::string&gt; <span class="title">parseFieldValue</span><span class="params">(<span class="type">const</span> Iterator begin, <span class="type">const</span> Iterator end)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            std::string result;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">auto</span> i = begin;</span><br><span class="line">            <span class="keyword">for</span> (; i != end &amp;&amp; (<span class="built_in">isWhiteSpaceChar</span>(*i) || <span class="built_in">isVisibleChar</span>(*i) || <span class="built_in">isObsoleteTextChar</span>(*i)); ++i)</span><br><span class="line">                result.<span class="built_in">push_back</span>(<span class="built_in">static_cast</span>&lt;<span class="type">char</span>&gt;(*i));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// trim white spaces</span></span><br><span class="line">            result.<span class="built_in">erase</span>(std::<span class="built_in">find_if</span>(result.<span class="built_in">rbegin</span>(), result.<span class="built_in">rend</span>(), [](<span class="type">const</span> <span class="type">char</span> c) <span class="keyword">noexcept</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> !<span class="built_in">isWhiteSpaceChar</span>(c);</span><br><span class="line">            &#125;).<span class="built_in">base</span>(), result.<span class="built_in">end</span>());</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> &#123;i, std::<span class="built_in">move</span>(result)&#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// RFC 7230, 3.2. Header Fields</span></span><br><span class="line">        <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Iterator</span>&gt;</span><br><span class="line">        <span class="function">std::pair&lt;Iterator, std::string&gt; <span class="title">parseFieldContent</span><span class="params">(<span class="type">const</span> Iterator begin, <span class="type">const</span> Iterator end)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            std::string result;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">auto</span> i = begin;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (;;)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">const</span> <span class="keyword">auto</span> fieldValueResult = <span class="built_in">parseFieldValue</span>(i, end);</span><br><span class="line">                i = fieldValueResult.first;</span><br><span class="line">                result += fieldValueResult.second;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Handle obsolete fold as per RFC 7230, 3.2.4. Field Parsing</span></span><br><span class="line">                <span class="comment">// Obsolete folding is known as linear white space (LWS) in RFC 2616, 2.2 Basic Rules</span></span><br><span class="line">                <span class="keyword">auto</span> obsoleteFoldIterator = i;</span><br><span class="line">                <span class="keyword">if</span> (obsoleteFoldIterator == end || *obsoleteFoldIterator++ != <span class="string">&#x27;\r&#x27;</span>)</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (obsoleteFoldIterator == end || *obsoleteFoldIterator++ != <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (obsoleteFoldIterator == end || !<span class="built_in">isWhiteSpaceChar</span>(*obsoleteFoldIterator++))</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                result.<span class="built_in">push_back</span>(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">                i = obsoleteFoldIterator;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> &#123;i, std::<span class="built_in">move</span>(result)&#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// RFC 7230, 3.2. Header Fields</span></span><br><span class="line">        <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Iterator</span>&gt;</span><br><span class="line">        <span class="function">std::pair&lt;Iterator, HeaderField&gt; <span class="title">parseHeaderField</span><span class="params">(<span class="type">const</span> Iterator begin, <span class="type">const</span> Iterator end)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">auto</span> tokenResult = <span class="built_in">parseToken</span>(begin, end);</span><br><span class="line">            <span class="keyword">auto</span> i = tokenResult.first;</span><br><span class="line">            <span class="keyword">auto</span> fieldName = std::<span class="built_in">move</span>(tokenResult.second);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (i == end || *i++ != <span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">                <span class="keyword">throw</span> ResponseError&#123;<span class="string">&quot;Invalid header&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">            i = <span class="built_in">skipWhiteSpaces</span>(i, end);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">auto</span> valueResult = <span class="built_in">parseFieldContent</span>(i, end);</span><br><span class="line">            i = valueResult.first;</span><br><span class="line">            <span class="keyword">auto</span> fieldValue = std::<span class="built_in">move</span>(valueResult.second);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (i == end || *i++ != <span class="string">&#x27;\r&#x27;</span>)</span><br><span class="line">                <span class="keyword">throw</span> ResponseError&#123;<span class="string">&quot;Invalid header&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (i == end || *i++ != <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">                <span class="keyword">throw</span> ResponseError&#123;<span class="string">&quot;Invalid header&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> &#123;i, &#123;std::<span class="built_in">move</span>(fieldName), std::<span class="built_in">move</span>(fieldValue)&#125;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// RFC 7230, 3.1.2. Status Line</span></span><br><span class="line">        <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Iterator</span>&gt;</span><br><span class="line">        <span class="function">std::pair&lt;Iterator, Status&gt; <span class="title">parseStatusLine</span><span class="params">(<span class="type">const</span> Iterator begin, <span class="type">const</span> Iterator end)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="type">const</span> <span class="keyword">auto</span> httpVersionResult = <span class="built_in">parseHttpVersion</span>(begin, end);</span><br><span class="line">            <span class="keyword">auto</span> i = httpVersionResult.first;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (i == end || *i++ != <span class="string">&#x27; &#x27;</span>)</span><br><span class="line">                <span class="keyword">throw</span> ResponseError&#123;<span class="string">&quot;Invalid status line&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">            <span class="type">const</span> <span class="keyword">auto</span> statusCodeResult = <span class="built_in">parseStatusCode</span>(i, end);</span><br><span class="line">            i = statusCodeResult.first;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (i == end || *i++ != <span class="string">&#x27; &#x27;</span>)</span><br><span class="line">                <span class="keyword">throw</span> ResponseError&#123;<span class="string">&quot;Invalid status line&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">auto</span> reasonPhraseResult = <span class="built_in">parseReasonPhrase</span>(i, end);</span><br><span class="line">            i = reasonPhraseResult.first;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (i == end || *i++ != <span class="string">&#x27;\r&#x27;</span>)</span><br><span class="line">                <span class="keyword">throw</span> ResponseError&#123;<span class="string">&quot;Invalid status line&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (i == end || *i++ != <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">                <span class="keyword">throw</span> ResponseError&#123;<span class="string">&quot;Invalid status line&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> &#123;i, Status&#123;</span><br><span class="line">                httpVersionResult.second,</span><br><span class="line">                statusCodeResult.second,</span><br><span class="line">                std::<span class="built_in">move</span>(reasonPhraseResult.second)</span><br><span class="line">            &#125;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// RFC 7230, 4.1. Chunked Transfer Coding</span></span><br><span class="line">        <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">class</span> <span class="title class_">Iterator</span>, <span class="keyword">typename</span> std::enable_if&lt;std::is_unsigned&lt;T&gt;::value&gt;::type* = <span class="literal">nullptr</span>&gt;</span><br><span class="line">        T <span class="built_in">stringToUint</span>(<span class="type">const</span> Iterator begin, <span class="type">const</span> Iterator end)</span><br><span class="line">        &#123;</span><br><span class="line">            T result = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> i = begin; i != end; ++i)</span><br><span class="line">                result = <span class="built_in">T</span>(<span class="number">10U</span>) * result + <span class="built_in">digitToUint</span>&lt;T&gt;(*i);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">class</span> <span class="title class_">Iterator</span>, <span class="keyword">typename</span> std::enable_if&lt;std::is_unsigned&lt;T&gt;::value&gt;::type* = <span class="literal">nullptr</span>&gt;</span><br><span class="line">        T <span class="built_in">hexStringToUint</span>(<span class="type">const</span> Iterator begin, <span class="type">const</span> Iterator end)</span><br><span class="line">        &#123;</span><br><span class="line">            T result = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> i = begin; i != end; ++i)</span><br><span class="line">                result = <span class="built_in">T</span>(<span class="number">16U</span>) * result + <span class="built_in">hexDigitToUint</span>&lt;T&gt;(*i);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// RFC 7230, 3.1.1. Request Line</span></span><br><span class="line">        <span class="function"><span class="keyword">inline</span> std::string <span class="title">encodeRequestLine</span><span class="params">(<span class="type">const</span> std::string&amp; method, <span class="type">const</span> std::string&amp; target)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> method + <span class="string">&quot; &quot;</span> + target + <span class="string">&quot; HTTP/1.1\r\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// RFC 7230, 3.2. Header Fields</span></span><br><span class="line">        <span class="function"><span class="keyword">inline</span> std::string <span class="title">encodeHeaderFields</span><span class="params">(<span class="type">const</span> HeaderFields&amp; headerFields)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            std::string result;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; headerField : headerFields)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (headerField.first.<span class="built_in">empty</span>())</span><br><span class="line">                    <span class="keyword">throw</span> RequestError&#123;<span class="string">&quot;Invalid header field name&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span> c : headerField.first)</span><br><span class="line">                    <span class="keyword">if</span> (!<span class="built_in">isTokenChar</span>(c))</span><br><span class="line">                        <span class="keyword">throw</span> RequestError&#123;<span class="string">&quot;Invalid header field name&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span> c : headerField.second)</span><br><span class="line">                    <span class="keyword">if</span> (!<span class="built_in">isWhiteSpaceChar</span>(c) &amp;&amp; !<span class="built_in">isVisibleChar</span>(c) &amp;&amp; !<span class="built_in">isObsoleteTextChar</span>(c))</span><br><span class="line">                        <span class="keyword">throw</span> RequestError&#123;<span class="string">&quot;Invalid header field value&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">                result += headerField.first + <span class="string">&quot;: &quot;</span> + headerField.second + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// RFC 4648, 4. Base 64 Encoding</span></span><br><span class="line">        <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Iterator</span>&gt;</span><br><span class="line">        <span class="function">std::string <span class="title">encodeBase64</span><span class="params">(<span class="type">const</span> Iterator begin, <span class="type">const</span> Iterator end)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">constexpr</span> std::array&lt;<span class="type">char</span>, 64&gt; chars&#123;</span><br><span class="line">                <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;J&#x27;</span>, <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;M&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;N&#x27;</span>, <span class="string">&#x27;O&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>, <span class="string">&#x27;Z&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;j&#x27;</span>, <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;m&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;q&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;z&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;+&#x27;</span>, <span class="string">&#x27;/&#x27;</span></span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            std::string result;</span><br><span class="line">            std::<span class="type">size_t</span> c = <span class="number">0</span>;</span><br><span class="line">            std::array&lt;std::<span class="type">uint8_t</span>, 3&gt; charArray;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> i = begin; i != end; ++i)</span><br><span class="line">            &#123;</span><br><span class="line">                charArray[c++] = <span class="built_in">static_cast</span>&lt;std::<span class="type">uint8_t</span>&gt;(*i);</span><br><span class="line">                <span class="keyword">if</span> (c == <span class="number">3</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    result += chars[<span class="built_in">static_cast</span>&lt;std::<span class="type">uint8_t</span>&gt;((charArray[<span class="number">0</span>] &amp; <span class="number">0xFC</span>) &gt;&gt; <span class="number">2</span>)];</span><br><span class="line">                    result += chars[<span class="built_in">static_cast</span>&lt;std::<span class="type">uint8_t</span>&gt;(((charArray[<span class="number">0</span>] &amp; <span class="number">0x03</span>) &lt;&lt; <span class="number">4</span>) + ((charArray[<span class="number">1</span>] &amp; <span class="number">0xF0</span>) &gt;&gt; <span class="number">4</span>))];</span><br><span class="line">                    result += chars[<span class="built_in">static_cast</span>&lt;std::<span class="type">uint8_t</span>&gt;(((charArray[<span class="number">1</span>] &amp; <span class="number">0x0F</span>) &lt;&lt; <span class="number">2</span>) + ((charArray[<span class="number">2</span>] &amp; <span class="number">0xC0</span>) &gt;&gt; <span class="number">6</span>))];</span><br><span class="line">                    result += chars[<span class="built_in">static_cast</span>&lt;std::<span class="type">uint8_t</span>&gt;(charArray[<span class="number">2</span>] &amp; <span class="number">0x3f</span>)];</span><br><span class="line">                    c = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (c)</span><br><span class="line">            &#123;</span><br><span class="line">                result += chars[<span class="built_in">static_cast</span>&lt;std::<span class="type">uint8_t</span>&gt;((charArray[<span class="number">0</span>] &amp; <span class="number">0xFC</span>) &gt;&gt; <span class="number">2</span>)];</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (c == <span class="number">1</span>)</span><br><span class="line">                    result += chars[<span class="built_in">static_cast</span>&lt;std::<span class="type">uint8_t</span>&gt;((charArray[<span class="number">0</span>] &amp; <span class="number">0x03</span>) &lt;&lt; <span class="number">4</span>)];</span><br><span class="line">                <span class="keyword">else</span> <span class="comment">// c == 2</span></span><br><span class="line">                &#123;</span><br><span class="line">                    result += chars[<span class="built_in">static_cast</span>&lt;std::<span class="type">uint8_t</span>&gt;(((charArray[<span class="number">0</span>] &amp; <span class="number">0x03</span>) &lt;&lt; <span class="number">4</span>) + ((charArray[<span class="number">1</span>] &amp; <span class="number">0xF0</span>) &gt;&gt; <span class="number">4</span>))];</span><br><span class="line">                    result += chars[<span class="built_in">static_cast</span>&lt;std::<span class="type">uint8_t</span>&gt;((charArray[<span class="number">1</span>] &amp; <span class="number">0x0F</span>) &lt;&lt; <span class="number">2</span>)];</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">while</span> (++c &lt; <span class="number">4</span>) result += <span class="string">&#x27;=&#x27;</span>; <span class="comment">// padding</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">inline</span> std::vector&lt;std::<span class="type">uint8_t</span>&gt; <span class="title">encodeHtml</span><span class="params">(<span class="type">const</span> Uri&amp; uri,</span></span></span><br><span class="line"><span class="params"><span class="function">                                                    <span class="type">const</span> std::string&amp; method,</span></span></span><br><span class="line"><span class="params"><span class="function">                                                    <span class="type">const</span> std::vector&lt;<span class="type">uint8_t</span>&gt;&amp; body,</span></span></span><br><span class="line"><span class="params"><span class="function">                                                    HeaderFields headerFields)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (uri.scheme != <span class="string">&quot;http&quot;</span>)</span><br><span class="line">                <span class="keyword">throw</span> RequestError&#123;<span class="string">&quot;Only HTTP scheme is supported&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// RFC 7230, 5.3. Request Target</span></span><br><span class="line">            <span class="type">const</span> std::string requestTarget = uri.path + (uri.query.<span class="built_in">empty</span>() ? <span class="string">&quot;&quot;</span>  : <span class="string">&#x27;?&#x27;</span> + uri.query);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// RFC 7230, 5.4. Host</span></span><br><span class="line">            headerFields.<span class="built_in">push_back</span>(&#123;<span class="string">&quot;Host&quot;</span>, uri.host&#125;);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// RFC 7230, 3.3.2. Content-Length</span></span><br><span class="line">            headerFields.<span class="built_in">push_back</span>(&#123;<span class="string">&quot;Content-Length&quot;</span>, std::<span class="built_in">to_string</span>(body.<span class="built_in">size</span>())&#125;);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// RFC 7617, 2. The &#x27;Basic&#x27; Authentication Scheme</span></span><br><span class="line">            <span class="keyword">if</span> (!uri.user.<span class="built_in">empty</span>() || !uri.password.<span class="built_in">empty</span>())</span><br><span class="line">            &#123;</span><br><span class="line">                std::string userinfo = uri.user + <span class="string">&#x27;:&#x27;</span> + uri.password;</span><br><span class="line">                headerFields.<span class="built_in">push_back</span>(&#123;<span class="string">&quot;Authorization&quot;</span>, <span class="string">&quot;Basic &quot;</span> + <span class="built_in">encodeBase64</span>(userinfo.<span class="built_in">begin</span>(), userinfo.<span class="built_in">end</span>())&#125;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">const</span> <span class="keyword">auto</span> headerData = <span class="built_in">encodeRequestLine</span>(method, requestTarget) +</span><br><span class="line">                <span class="built_in">encodeHeaderFields</span>(headerFields) +</span><br><span class="line">                <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="function">std::vector&lt;<span class="type">uint8_t</span>&gt; <span class="title">result</span><span class="params">(headerData.begin(), headerData.end())</span></span>;</span><br><span class="line">            result.<span class="built_in">insert</span>(result.<span class="built_in">end</span>(), body.<span class="built_in">begin</span>(), body.<span class="built_in">end</span>());</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Request</span> <span class="keyword">final</span></span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="function"><span class="keyword">explicit</span> <span class="title">Request</span><span class="params">(<span class="type">const</span> std::string&amp; uriString,</span></span></span><br><span class="line"><span class="params"><span class="function">                         <span class="type">const</span> InternetProtocol protocol = InternetProtocol::V4)</span>:</span></span><br><span class="line"><span class="function">            internetProtocol&#123;</span>protocol&#125;,</span><br><span class="line">            uri&#123;<span class="built_in">parseUri</span>(uriString.<span class="built_in">begin</span>(), uriString.<span class="built_in">end</span>())&#125;</span><br><span class="line">        &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function">Response <span class="title">send</span><span class="params">(<span class="type">const</span> std::string&amp; method = <span class="string">&quot;GET&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">                      <span class="type">const</span> std::string&amp; body = <span class="string">&quot;&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">                      <span class="type">const</span> HeaderFields&amp; headerFields = &#123;&#125;,</span></span></span><br><span class="line"><span class="params"><span class="function">                      <span class="type">const</span> std::chrono::milliseconds timeout = std::chrono::milliseconds&#123;<span class="number">-1</span>&#125;)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">send</span>(method,</span><br><span class="line">                        std::<span class="built_in">vector</span>&lt;<span class="type">uint8_t</span>&gt;(body.<span class="built_in">begin</span>(), body.<span class="built_in">end</span>()),</span><br><span class="line">                        headerFields,</span><br><span class="line">                        timeout);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function">Response <span class="title">send</span><span class="params">(<span class="type">const</span> std::string&amp; method,</span></span></span><br><span class="line"><span class="params"><span class="function">                      <span class="type">const</span> std::vector&lt;<span class="type">uint8_t</span>&gt;&amp; body,</span></span></span><br><span class="line"><span class="params"><span class="function">                      <span class="type">const</span> HeaderFields&amp; headerFields = &#123;&#125;,</span></span></span><br><span class="line"><span class="params"><span class="function">                      <span class="type">const</span> std::chrono::milliseconds timeout = std::chrono::milliseconds&#123;<span class="number">-1</span>&#125;)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="type">const</span> <span class="keyword">auto</span> stopTime = std::chrono::steady_clock::<span class="built_in">now</span>() + timeout;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (uri.scheme != <span class="string">&quot;http&quot;</span>)</span><br><span class="line">                <span class="keyword">throw</span> RequestError&#123;<span class="string">&quot;Only HTTP scheme is supported&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">            addrinfo hints = &#123;&#125;;</span><br><span class="line">            hints.ai_family = <span class="built_in">getAddressFamily</span>(internetProtocol);</span><br><span class="line">            hints.ai_socktype = SOCK_STREAM;</span><br><span class="line"></span><br><span class="line">            <span class="type">const</span> <span class="type">char</span>* port = uri.port.<span class="built_in">empty</span>() ? <span class="string">&quot;80&quot;</span> : uri.port.<span class="built_in">c_str</span>();</span><br><span class="line"></span><br><span class="line">            addrinfo* info;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">getaddrinfo</span>(uri.host.<span class="built_in">c_str</span>(), port, &amp;hints, &amp;info) != <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">throw</span> std::system_error&#123;<span class="built_in">getLastError</span>(), std::<span class="built_in">system_category</span>(), <span class="string">&quot;Failed to get address info of &quot;</span> + uri.host&#125;;</span><br><span class="line"></span><br><span class="line">            <span class="type">const</span> std::unique_ptr&lt;addrinfo, <span class="keyword">decltype</span>(&amp;freeaddrinfo)&gt; addressInfo&#123;info, freeaddrinfo&#125;;</span><br><span class="line"></span><br><span class="line">            <span class="type">const</span> <span class="keyword">auto</span> requestData = <span class="built_in">encodeHtml</span>(uri, method, body, headerFields);</span><br><span class="line"></span><br><span class="line">            Socket socket&#123;internetProtocol&#125;;</span><br><span class="line"></span><br><span class="line">            <span class="type">const</span> <span class="keyword">auto</span> getRemainingMilliseconds = [](<span class="type">const</span> std::chrono::steady_clock::time_point time) <span class="keyword">noexcept</span> -&gt; std::<span class="type">int64_t</span> &#123;</span><br><span class="line">                <span class="type">const</span> <span class="keyword">auto</span> now = std::chrono::steady_clock::<span class="built_in">now</span>();</span><br><span class="line">                <span class="type">const</span> <span class="keyword">auto</span> remainingTime = std::chrono::<span class="built_in">duration_cast</span>&lt;std::chrono::milliseconds&gt;(time - now);</span><br><span class="line">                <span class="keyword">return</span> (remainingTime.<span class="built_in">count</span>() &gt; <span class="number">0</span>) ? remainingTime.<span class="built_in">count</span>() : <span class="number">0</span>;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// take the first address from the list</span></span><br><span class="line">            socket.<span class="built_in">connect</span>(addressInfo-&gt;ai_addr, <span class="built_in">static_cast</span>&lt;<span class="type">socklen_t</span>&gt;(addressInfo-&gt;ai_addrlen),</span><br><span class="line">                           (timeout.<span class="built_in">count</span>() &gt;= <span class="number">0</span>) ? <span class="built_in">getRemainingMilliseconds</span>(stopTime) : <span class="number">-1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">auto</span> remaining = requestData.<span class="built_in">size</span>();</span><br><span class="line">            <span class="keyword">auto</span> sendData = requestData.<span class="built_in">data</span>();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// send the request</span></span><br><span class="line">            <span class="keyword">while</span> (remaining &gt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">const</span> <span class="keyword">auto</span> size = socket.<span class="built_in">send</span>(sendData, remaining,</span><br><span class="line">                                              (timeout.<span class="built_in">count</span>() &gt;= <span class="number">0</span>) ? <span class="built_in">getRemainingMilliseconds</span>(stopTime) : <span class="number">-1</span>);</span><br><span class="line">                remaining -= size;</span><br><span class="line">                sendData += size;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            std::array&lt;std::<span class="type">uint8_t</span>, 4096&gt; tempBuffer;</span><br><span class="line">            <span class="keyword">constexpr</span> std::array&lt;std::<span class="type">uint8_t</span>, 2&gt; crlf = &#123;<span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>&#125;;</span><br><span class="line">            <span class="keyword">constexpr</span> std::array&lt;std::<span class="type">uint8_t</span>, 4&gt; headerEnd = &#123;<span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>&#125;;</span><br><span class="line">            Response response;</span><br><span class="line">            std::vector&lt;std::<span class="type">uint8_t</span>&gt; responseData;</span><br><span class="line">            <span class="type">bool</span> parsingBody = <span class="literal">false</span>;</span><br><span class="line">            <span class="type">bool</span> contentLengthReceived = <span class="literal">false</span>;</span><br><span class="line">            std::<span class="type">size_t</span> contentLength = <span class="number">0U</span>;</span><br><span class="line">            <span class="type">bool</span> chunkedResponse = <span class="literal">false</span>;</span><br><span class="line">            std::<span class="type">size_t</span> expectedChunkSize = <span class="number">0U</span>;</span><br><span class="line">            <span class="type">bool</span> removeCrlfAfterChunk = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// read the response</span></span><br><span class="line">            <span class="keyword">for</span> (;;)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">const</span> <span class="keyword">auto</span> size = socket.<span class="built_in">recv</span>(tempBuffer.<span class="built_in">data</span>(), tempBuffer.<span class="built_in">size</span>(),</span><br><span class="line">                                              (timeout.<span class="built_in">count</span>() &gt;= <span class="number">0</span>) ? <span class="built_in">getRemainingMilliseconds</span>(stopTime) : <span class="number">-1</span>);</span><br><span class="line">                <span class="keyword">if</span> (size == <span class="number">0</span>) <span class="comment">// disconnected</span></span><br><span class="line">                    <span class="keyword">return</span> response;</span><br><span class="line"></span><br><span class="line">                responseData.<span class="built_in">insert</span>(responseData.<span class="built_in">end</span>(), tempBuffer.<span class="built_in">begin</span>(), tempBuffer.<span class="built_in">begin</span>() + size);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (!parsingBody)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// RFC 7230, 3. Message Format</span></span><br><span class="line">                    <span class="comment">// Empty line indicates the end of the header section (RFC 7230, 2.1. Client/Server Messaging)</span></span><br><span class="line">                    <span class="type">const</span> <span class="keyword">auto</span> endIterator = std::<span class="built_in">search</span>(responseData.<span class="built_in">cbegin</span>(), responseData.<span class="built_in">cend</span>(),</span><br><span class="line">                                                         headerEnd.<span class="built_in">cbegin</span>(), headerEnd.<span class="built_in">cend</span>());</span><br><span class="line">                    <span class="keyword">if</span> (endIterator == responseData.<span class="built_in">cend</span>()) <span class="keyword">break</span>; <span class="comment">// two consecutive CRLFs not found</span></span><br><span class="line"></span><br><span class="line">                    <span class="type">const</span> <span class="keyword">auto</span> headerBeginIterator = responseData.<span class="built_in">cbegin</span>();</span><br><span class="line">                    <span class="type">const</span> <span class="keyword">auto</span> headerEndIterator = endIterator + <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">auto</span> statusLineResult = <span class="built_in">parseStatusLine</span>(headerBeginIterator, headerEndIterator);</span><br><span class="line">                    <span class="keyword">auto</span> i = statusLineResult.first;</span><br><span class="line"></span><br><span class="line">                    response.status = std::<span class="built_in">move</span>(statusLineResult.second);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">for</span> (;;)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">auto</span> headerFieldResult = <span class="built_in">parseHeaderField</span>(i, headerEndIterator);</span><br><span class="line">                        i = headerFieldResult.first;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">auto</span> fieldName = std::<span class="built_in">move</span>(headerFieldResult.second.first);</span><br><span class="line">                        <span class="type">const</span> <span class="keyword">auto</span> toLower = [](<span class="type">const</span> <span class="type">char</span> c) <span class="keyword">noexcept</span> &#123;</span><br><span class="line">                            <span class="built_in">return</span> (c &gt;= <span class="string">&#x27;A&#x27;</span> &amp;&amp; c &lt;= <span class="string">&#x27;Z&#x27;</span>) ? c - (<span class="string">&#x27;A&#x27;</span> - <span class="string">&#x27;a&#x27;</span>) : c;</span><br><span class="line">                        &#125;;</span><br><span class="line">                        std::<span class="built_in">transform</span>(fieldName.<span class="built_in">begin</span>(), fieldName.<span class="built_in">end</span>(), fieldName.<span class="built_in">begin</span>(), toLower);</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">auto</span> fieldValue = std::<span class="built_in">move</span>(headerFieldResult.second.second);</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (fieldName == <span class="string">&quot;transfer-encoding&quot;</span>)</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="comment">// RFC 7230, 3.3.1. Transfer-Encoding</span></span><br><span class="line">                            <span class="keyword">if</span> (fieldValue == <span class="string">&quot;chunked&quot;</span>)</span><br><span class="line">                                chunkedResponse = <span class="literal">true</span>;</span><br><span class="line">                            <span class="keyword">else</span></span><br><span class="line">                                <span class="keyword">throw</span> ResponseError&#123;<span class="string">&quot;Unsupported transfer encoding: &quot;</span> + fieldValue&#125;;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span> (fieldName == <span class="string">&quot;content-length&quot;</span>)</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="comment">// RFC 7230, 3.3.2. Content-Length</span></span><br><span class="line">                            contentLength = <span class="built_in">stringToUint</span>&lt;std::<span class="type">size_t</span>&gt;(fieldValue.<span class="built_in">cbegin</span>(), fieldValue.<span class="built_in">cend</span>());</span><br><span class="line">                            contentLengthReceived = <span class="literal">true</span>;</span><br><span class="line">                            response.body.<span class="built_in">reserve</span>(contentLength);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        response.headerFields.<span class="built_in">push_back</span>(&#123;std::<span class="built_in">move</span>(fieldName), std::<span class="built_in">move</span>(fieldValue)&#125;);</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (i == headerEndIterator)</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    responseData.<span class="built_in">erase</span>(responseData.<span class="built_in">cbegin</span>(), headerEndIterator + <span class="number">2</span>);</span><br><span class="line">                    parsingBody = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (parsingBody)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// Content-Length must be ignored if Transfer-Encoding is received (RFC 7230, 3.2. Content-Length)</span></span><br><span class="line">                    <span class="keyword">if</span> (chunkedResponse)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="comment">// RFC 7230, 4.1. Chunked Transfer Coding</span></span><br><span class="line">                        <span class="keyword">for</span> (;;)</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="keyword">if</span> (expectedChunkSize &gt; <span class="number">0</span>)</span><br><span class="line">                            &#123;</span><br><span class="line">                                <span class="type">const</span> <span class="keyword">auto</span> toWrite = (std::min)(expectedChunkSize, responseData.<span class="built_in">size</span>());</span><br><span class="line">                                response.body.<span class="built_in">insert</span>(response.body.<span class="built_in">end</span>(), responseData.<span class="built_in">begin</span>(),</span><br><span class="line">                                                     responseData.<span class="built_in">begin</span>() + <span class="built_in">static_cast</span>&lt;std::<span class="type">ptrdiff_t</span>&gt;(toWrite));</span><br><span class="line">                                responseData.<span class="built_in">erase</span>(responseData.<span class="built_in">begin</span>(),</span><br><span class="line">                                                   responseData.<span class="built_in">begin</span>() + <span class="built_in">static_cast</span>&lt;std::<span class="type">ptrdiff_t</span>&gt;(toWrite));</span><br><span class="line">                                expectedChunkSize -= toWrite;</span><br><span class="line"></span><br><span class="line">                                <span class="keyword">if</span> (expectedChunkSize == <span class="number">0</span>) removeCrlfAfterChunk = <span class="literal">true</span>;</span><br><span class="line">                                <span class="keyword">if</span> (responseData.<span class="built_in">empty</span>()) <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">else</span></span><br><span class="line">                            &#123;</span><br><span class="line">                                <span class="keyword">if</span> (removeCrlfAfterChunk)</span><br><span class="line">                                &#123;</span><br><span class="line">                                    <span class="keyword">if</span> (responseData.<span class="built_in">size</span>() &lt; <span class="number">2</span>) <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                                    <span class="keyword">if</span> (!std::<span class="built_in">equal</span>(crlf.<span class="built_in">begin</span>(), crlf.<span class="built_in">end</span>(), responseData.<span class="built_in">begin</span>()))</span><br><span class="line">                                        <span class="keyword">throw</span> ResponseError&#123;<span class="string">&quot;Invalid chunk&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">                                    removeCrlfAfterChunk = <span class="literal">false</span>;</span><br><span class="line">                                    responseData.<span class="built_in">erase</span>(responseData.<span class="built_in">begin</span>(), responseData.<span class="built_in">begin</span>() + <span class="number">2</span>);</span><br><span class="line">                                &#125;</span><br><span class="line"></span><br><span class="line">                                <span class="type">const</span> <span class="keyword">auto</span> i = std::<span class="built_in">search</span>(responseData.<span class="built_in">begin</span>(), responseData.<span class="built_in">end</span>(),</span><br><span class="line">                                                           crlf.<span class="built_in">begin</span>(), crlf.<span class="built_in">end</span>());</span><br><span class="line"></span><br><span class="line">                                <span class="keyword">if</span> (i == responseData.<span class="built_in">end</span>()) <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                                expectedChunkSize = detail::<span class="built_in">hexStringToUint</span>&lt;std::<span class="type">size_t</span>&gt;(responseData.<span class="built_in">begin</span>(), i);</span><br><span class="line">                                responseData.<span class="built_in">erase</span>(responseData.<span class="built_in">begin</span>(), i + <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">                                <span class="keyword">if</span> (expectedChunkSize == <span class="number">0</span>)</span><br><span class="line">                                    <span class="keyword">return</span> response;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        response.body.<span class="built_in">insert</span>(response.body.<span class="built_in">end</span>(), responseData.<span class="built_in">begin</span>(), responseData.<span class="built_in">end</span>());</span><br><span class="line">                        responseData.<span class="built_in">clear</span>();</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// got the whole content</span></span><br><span class="line">                        <span class="keyword">if</span> (contentLengthReceived &amp;&amp; response.body.<span class="built_in">size</span>() &gt;= contentLength)</span><br><span class="line">                            <span class="keyword">return</span> response;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> response;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(_WIN32) || defined(__CYGWIN__)</span></span><br><span class="line">        WinSock winSock;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// defined(_WIN32) || defined(__CYGWIN__)</span></span></span><br><span class="line">        InternetProtocol internetProtocol;</span><br><span class="line">        Uri uri;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// HTTPREQUEST_HPP</span></span></span><br></pre></td></tr></table></figure>

<h1 id="参考资料："><a href="#参考资料：" class="headerlink" title="参考资料："></a>参考资料：</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/wsgxg/p/14744678.html">网络编程（Win&#x2F;Linux）：理解select函数并实现IO复用服务器端 - 戈小戈 - 博客园</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/giantpoplar/article/details/47658929">Socket通信——C++服务器端和Java客户端_xcy6666的博客-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u014080185/article/details/78680901">C++和java通过Socket批量发送和接收文件（C++客户端发送，java服务端接收）_wengtengfan的博客-CSDN博客_socket 批量发送</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.51cto.com/iteyer/3236621">java 发送字节流图片，c++接收二进制流_51CTO博客_c++读取二进制文件</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u014080185/article/details/78680901">C++和java通过Socket批量发送和接收文件（C++客户端发送，java服务端接收）_wengtengfan的博客-CSDN博客_socket 批量发送</a></p>
<p><a target="_blank" rel="noopener" href="https://m.2cto.com/kf/201609/548246.html">Java客户端上传图片（文件）到c++服务器 - c++语言程序开发技术文章_c++编程 - 红黑联盟</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/katiejyoung/file-transfer-system/blob/master/FTClient.java">https://github.com/katiejyoung/file-transfer-system/blob/master/FTClient.java</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/katiejyoung/file-transfer-system/blob/master/ftserver.c">file-transfer-system&#x2F;ftserver.c at master · katiejyoung&#x2F;file-transfer-system · GitHub</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/giantpoplar/article/details/47658929">Socket通信——C++服务器端和Java客户端_xcy6666的博客-CSDN博客</a></p>
<hr>
<p>java:</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_49862595/article/details/127453708">Java实现socket通信详解(UDP&#x2F;TCP)c&#x2F;s模式_寒风凋零的博客-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_57099067/article/details/124258729">使用Java完成Socket通信_牛言牛语的博客-CSDN博客_java socket通信</a></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/C/" rel="tag"># C++</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/07/11/Sub_Language/CPlus/CPlus_JSON/" rel="prev" title="C++ JSON">
      <i class="fa fa-chevron-left"></i> C++ JSON
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/07/20/Course/SLAM/ch06_Ceres_g2o/" rel="next" title="SLAM 第六讲 非线性优化">
      SLAM 第六讲 非线性优化 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2"><span class="nav-number">1.</span> <span class="nav-text">数据转换</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#C-sockt"><span class="nav-number">2.</span> <span class="nav-text">C++ sockt</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#recv"><span class="nav-number">2.1.</span> <span class="nav-text">recv</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#FIX-01-%E2%80%9Cundefined-reference-to-imp-WSAStartup%E2%80%99%E2%80%9D"><span class="nav-number">2.1.1.</span> <span class="nav-text">FIX-01 “undefined reference to __imp_WSAStartup’”</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Windows-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B"><span class="nav-number">3.</span> <span class="nav-text">Windows 网络编程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#UDP-Send-Recv-Text"><span class="nav-number">3.1.</span> <span class="nav-text">UDP (Send&#x2F;Recv Text)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Sever"><span class="nav-number">3.1.1.</span> <span class="nav-text">Sever</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#client"><span class="nav-number">3.1.2.</span> <span class="nav-text">client</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#demo-Socket%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93"><span class="nav-number">4.</span> <span class="nav-text">demo::Socket文件传输</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#LINUX%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B"><span class="nav-number">5.</span> <span class="nav-text">LINUX网络编程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="nav-number">5.1.</span> <span class="nav-text">基础知识</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Client"><span class="nav-number">5.2.</span> <span class="nav-text">Client</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Server"><span class="nav-number">5.3.</span> <span class="nav-text">Server</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#C-Http"><span class="nav-number">6.</span> <span class="nav-text">C++ Http</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTPRequest-hpp"><span class="nav-number">6.0.1.</span> <span class="nav-text">HTTPRequest.hpp</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99%EF%BC%9A"><span class="nav-number">7.</span> <span class="nav-text">参考资料：</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Simon Shi</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">322</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">142</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">269</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="mailto:yourname@gmail.com" title="E-Mail → mailto:yourname@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Simon Shi</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  

</body>
</html>
